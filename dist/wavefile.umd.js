Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{value:function(searchElement,fromIndex){if(null==this)throw new TypeError('"this" is null or not defined');var o=Object(this),len=o.length>>>0;if(0===len)return!1;var x,y,n=0|fromIndex,k=Math.max(n>=0?n:len-Math.abs(n),0);for(;k<len;){if((x=o[k])===(y=searchElement)||"number"==typeof x&&"number"==typeof y&&isNaN(x)&&isNaN(y))return!0;k++}return!1}}),String.prototype.codePointAt||function(){"use strict";var defineProperty=function(){try{var object={},$defineProperty=Object.defineProperty,result=$defineProperty(object,object,object)&&$defineProperty}catch(error){}return result}(),codePointAt=function(position){if(null==this)throw TypeError();var string=String(this),size=string.length,index=position?Number(position):0;if(index!=index&&(index=0),!(index<0||index>=size)){var second,first=string.charCodeAt(index);return first>=55296&&first<=56319&&size>index+1&&(second=string.charCodeAt(index+1))>=56320&&second<=57343?1024*(first-55296)+second-56320+65536:first}};defineProperty?defineProperty(String.prototype,"codePointAt",{value:codePointAt,configurable:!0,writable:!0}):String.prototype.codePointAt=codePointAt}(),Uint8Array.prototype.slice||Object.defineProperty(Uint8Array.prototype,"slice",{value:Array.prototype.slice}),function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory():"function"==typeof define&&define.amd?define(factory):global.WaveFile=factory()}(this,function(){"use strict";var f64f32_=new Float32Array(1);function bitDepth(input,original,target,output){validateBitDepth_(original),validateBitDepth_(target);var toFunction=function(original,target){var func=function(x){return x};original!=target&&(func=["32f","64"].includes(original)?["32f","64"].includes(target)?floatToFloat_:floatToInt_:["32f","64"].includes(target)?intToFloat_:intToInt_);return func}(original,target),options={oldMin:Math.pow(2,parseInt(original,10))/2,newMin:Math.pow(2,parseInt(target,10))/2,oldMax:Math.pow(2,parseInt(original,10))/2-1,newMax:Math.pow(2,parseInt(target,10))/2-1},len=input.length;if("8"==original)for(var i=0;i<len;i++)output[i]=input[i]-=128;for(var _i=0;_i<len;_i++)output[_i]=toFunction(input[_i],options);if("8"==target)for(var _i2=0;_i2<len;_i2++)output[_i2]=output[_i2]+=128}function intToInt_(sample,args){return sample=sample>0?parseInt(sample/args.oldMax*args.newMax,10):parseInt(sample/args.oldMin*args.newMin,10)}function floatToInt_(sample,args){return parseInt(sample>0?sample*args.newMax:sample*args.newMin,10)}function intToFloat_(sample,args){return sample>0?sample/args.oldMax:sample/args.oldMin}function floatToFloat_(sample){return f64f32_[0]=sample,f64f32_[0]}function validateBitDepth_(bitDepth){if("32f"!=bitDepth&&"64"!=bitDepth&&(parseInt(bitDepth,10)<"8"||parseInt(bitDepth,10)>"53"))throw new Error("Invalid bit depth.")}var INDEX_TABLE=[-1,-1,-1,-1,2,4,6,8,-1,-1,-1,-1,2,4,6,8],STEP_TABLE=[7,8,9,10,11,12,13,14,16,17,19,21,23,25,28,31,34,37,41,45,50,55,60,66,73,80,88,97,107,118,130,143,157,173,190,209,230,253,279,307,337,371,408,449,494,544,598,658,724,796,876,963,1060,1166,1282,1411,1552,1707,1878,2066,2272,2499,2749,3024,3327,3660,4026,4428,4871,5358,5894,6484,7132,7845,8630,9493,10442,11487,12635,13899,15289,16818,18500,20350,22385,24623,27086,29794,32767],encoderPredicted_=0,encoderIndex_=0,decoderPredicted_=0,decoderIndex_=0,decoderStep_=7;function encodeBlock(block){for(var adpcmSamples=function(sample){encodeSample_(sample);var adpcmSamples=[];return adpcmSamples.push(255&sample),adpcmSamples.push(sample>>8&255),adpcmSamples.push(encoderIndex_),adpcmSamples.push(0),adpcmSamples}(block[0]),i=3;i<block.length;i+=2){var sample2=encodeSample_(block[i]),sample=encodeSample_(block[i+1]);adpcmSamples.push(sample<<4|sample2)}for(;adpcmSamples.length<256;)adpcmSamples.push(0);return adpcmSamples}function decodeBlock(block){decoderPredicted_=sign_(block[1]<<8|block[0]),decoderIndex_=block[2],decoderStep_=STEP_TABLE[decoderIndex_];for(var result=[decoderPredicted_,sign_(block[3]<<8|block[2])],i=4;i<block.length;i++){var original_sample=block[i],second_sample=original_sample>>4,first_sample=second_sample<<4^original_sample;result.push(decodeSample_(first_sample)),result.push(decodeSample_(second_sample))}return result}function sign_(num){return num>32768?num-65536:num}function encodeSample_(sample){var delta=sample-encoderPredicted_,value=0;delta>=0?value=0:(value=8,delta=-delta);var step=STEP_TABLE[encoderIndex_],diff=step>>3;return delta>step&&(value|=4,delta-=step,diff+=step),delta>(step>>=1)&&(value|=2,delta-=step,diff+=step),delta>(step>>=1)&&(value|=1,diff+=step),function(value,diff){8&value?encoderPredicted_-=diff:encoderPredicted_+=diff;encoderPredicted_<-32768?encoderPredicted_=-32768:encoderPredicted_>32767&&(encoderPredicted_=32767);(encoderIndex_+=INDEX_TABLE[7&value])<0?encoderIndex_=0:encoderIndex_>88&&(encoderIndex_=88)}(value,diff),value}function decodeSample_(nibble){var difference=0;return 4&nibble&&(difference+=decoderStep_),2&nibble&&(difference+=decoderStep_>>1),1&nibble&&(difference+=decoderStep_>>2),difference+=decoderStep_>>3,8&nibble&&(difference=-difference),(decoderPredicted_+=difference)>32767?decoderPredicted_=32767:decoderPredicted_<-32767&&(decoderPredicted_=-32767),function(nibble){(decoderIndex_+=INDEX_TABLE[nibble])<0?decoderIndex_=0:decoderIndex_>88&&(decoderIndex_=88);decoderStep_=STEP_TABLE[decoderIndex_]}(nibble),decoderPredicted_}var LOG_TABLE=[1,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7];function encodeSample(sample){var compandedValue=void 0,sign=~(sample=-32768==sample?-32767:sample)>>8&128;if(sign||(sample*=-1),sample>32635&&(sample=32635),sample>=256){var exponent=LOG_TABLE[sample>>8&127];compandedValue=exponent<<4|sample>>exponent+3&15}else compandedValue=sample>>4;return 85^compandedValue^sign}function decodeSample(aLawSample){var sign=0;128&(aLawSample^=85)&&(aLawSample&=-129,sign=-1);var position=4+((240&aLawSample)>>4),decoded=0;return decoded=4!=position?1<<position|(15&aLawSample)<<position-4|1<<position-5:aLawSample<<1|1,8*(decoded=0===sign?decoded:-decoded)*-1}var BIAS=132,CLIP=32635,encodeTable=[0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7],decodeTable=[0,132,396,924,1980,4092,8316,16764];for(var chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",lookup=new Uint8Array(256),i=0;i<chars.length;i++)lookup[chars.charCodeAt(i)]=i;function endianness(bytes,offset){var start=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,end=arguments.length>3&&void 0!==arguments[3]?arguments[3]:bytes.length;if(end%offset)throw new Error("Bad buffer length.");for(var index=start;index<end;index+=offset)swap(bytes,offset,index)}function swap(bytes,offset,index){offset--;for(var x=0;x<offset;x++){var theByte=bytes[index+x];bytes[index+x]=bytes[index+offset],bytes[index+offset]=theByte,offset--}}function pack(str,buffer){for(var index=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=0,len=str.length;i<len;i++){var codePoint=str.codePointAt(i);if(codePoint<128)buffer[index]=codePoint,index++;else{var count=0,offset=0;for(codePoint<=2047?(count=1,offset=192):codePoint<=65535?(count=2,offset=224):codePoint<=1114111&&(count=3,offset=240,i++),buffer[index]=(codePoint>>6*count)+offset,index++;count>0;)buffer[index]=128|codePoint>>6*(count-1)&63,index++,count--}}return index}var classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),get=function get(object,property,receiver){null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc)return desc.value;var getter=desc.get;return void 0!==getter?getter.call(receiver):void 0},inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)},possibleConstructorReturn=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call},UintBuffer=function(){function UintBuffer(bits){classCallCheck(this,UintBuffer),this.bits=bits,this.bytes=bits<8?1:Math.ceil(bits/8),this.max=Math.pow(2,bits)-1,this.min=0;var r=8-(1+(bits-1|7)-bits);this.lastByteMask_=Math.pow(2,r>0?r:8)-1}return createClass(UintBuffer,[{key:"pack",value:function(buffer,num){var index=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(num!=num)throw new Error("NaN");this.overflow(num),buffer[index]=255&(num<0?num+Math.pow(2,this.bits):num),index++;for(var len=this.bytes,i=2;i<len;i++)buffer[index]=255&Math.floor(num/Math.pow(2,8*(i-1))),index++;return this.bits>8&&(buffer[index]=Math.floor(num/Math.pow(2,8*(this.bytes-1)))&this.lastByteMask_,index++),index}},{key:"unpack",value:function(buffer){var index=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,num=this.unpackUnsafe(buffer,index);return this.overflow(num),num}},{key:"unpackUnsafe",value:function(buffer,index){for(var num=0,x=0;x<this.bytes;x++)num+=buffer[index+x]*Math.pow(256,x);return num}},{key:"overflow",value:function(num){if(num>this.max||num<this.min)throw new Error("Overflow")}}]),UintBuffer}(),TwosComplementBuffer=function(_UintBuffer){function TwosComplementBuffer(bits){classCallCheck(this,TwosComplementBuffer);var _this=possibleConstructorReturn(this,(TwosComplementBuffer.__proto__||Object.getPrototypeOf(TwosComplementBuffer)).call(this,bits));return _this.max=Math.pow(2,_this.bits)/2-1,_this.min=-_this.max-1,_this}return inherits(TwosComplementBuffer,UintBuffer),createClass(TwosComplementBuffer,[{key:"pack",value:function(buffer,num){var index=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return get(TwosComplementBuffer.prototype.__proto__||Object.getPrototypeOf(TwosComplementBuffer.prototype),"pack",this).call(this,buffer,num,index)}},{key:"unpack",value:function(buffer){var index=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,num=get(TwosComplementBuffer.prototype.__proto__||Object.getPrototypeOf(TwosComplementBuffer.prototype),"unpackUnsafe",this).call(this,buffer,index);return num=this.sign_(num),this.overflow(num),num}},{key:"sign_",value:function(num){return num>this.max&&(num-=2*this.max+2),num}}]),TwosComplementBuffer}(),IntBuffer=function(){function IntBuffer(bits,signed){classCallCheck(this,IntBuffer),this.parser=signed?new TwosComplementBuffer(bits):new UintBuffer(bits)}return createClass(IntBuffer,[{key:"pack",value:function(buffer,num){var index=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.parser.pack(buffer,num,index)}},{key:"unpack",value:function(buffer){var index=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.parser.unpack(buffer,index)}}]),IntBuffer}(),typeDefinition="Unsupported type";function validateValueType(value){if(void 0===value)throw new Error("Undefined value");if(null!==value&&value.constructor!=Number&&value.constructor!=Boolean)throw new Error("Can't pack "+value.constructor)}function validateType(theType){if(!theType)throw new Error(typeDefinition);theType.float?function(theType){if(16!=theType.bits&&32!=theType.bits&&64!=theType.bits)throw new Error(typeDefinition)}(theType):function(theType){if(theType.bits<1||theType.bits>53)throw new Error(typeDefinition)}(theType)}function pack$1(buffer,index,num,ebits,fbits){var bias=(1<<ebits-1)-1;Math.abs(num)>Math.pow(2,bias+1)-2*(ebits+fbits)&&(num=num<0?-1/0:1/0);var sign=((num=+num)||1/num)<0?1:num<0?1:0;num=Math.abs(num);var exp=Math.min(Math.floor(Math.log(num)/Math.LN2),1023),fraction=roundToEven(num/Math.pow(2,exp)*Math.pow(2,fbits));return num!=num?(fraction=Math.pow(2,fbits-1),exp=(1<<ebits)-1):0!==num&&(num>=Math.pow(2,1-bias)?(fraction/Math.pow(2,fbits)>=2&&(exp+=1,fraction=1),exp>bias?(exp=(1<<ebits)-1,fraction=0):(exp+=bias,fraction=roundToEven(fraction)-Math.pow(2,fbits))):(fraction=roundToEven(num/Math.pow(2,1-bias-fbits)),exp=0)),function(buffer,index,ebits,fbits,sign,exp,fraction){var bits=[];bits.push(sign);for(var i=ebits;i>0;i-=1)bits[i]=exp%2?1:0,exp=Math.floor(exp/2);for(var len=bits.length,_i=fbits;_i>0;_i-=1)bits[len+_i]=fraction%2?1:0,fraction=Math.floor(fraction/2);var str=bits.join(""),numBytes=Math.floor((ebits+fbits+1)/8)+index-1,k=index;for(;numBytes>=index;)buffer[numBytes]=parseInt(str.substring(0,8),2),str=str.substring(8),numBytes--,k++;return k}(buffer,index,ebits,fbits,sign,exp,fraction)}function unpack$1(buffer,index,ebits,fbits){for(var exponentBias=(1<<ebits-1)-1,numBytes=Math.ceil((ebits+fbits)/8),eMax=(1<<ebits)-1,bias=Math.pow(2,-(8*numBytes-1-ebits)),significand=void 0,leftBits="",i=numBytes-1;i>=0;i--){var t=buffer[i+index].toString(2);leftBits+="00000000".substring(t.length)+t}var sign="1"==leftBits.charAt(0)?-1:1;leftBits=leftBits.substring(1);var exponent=parseInt(leftBits.substring(0,ebits),2);return leftBits=leftBits.substring(ebits),exponent==eMax?0!==parseInt(leftBits,2)?NaN:sign*(1/0):(0===exponent?(exponent+=1,significand=parseInt(leftBits,2)):significand=parseInt("1"+leftBits,2),sign*significand*bias*Math.pow(2,exponent-exponentBias))}function roundToEven(n){var w=Math.floor(n),f=n-w;return f<.5?w:f>.5?w+1:w%2?w+1:w}var NumberBuffer=function(_IntBuffer){function NumberBuffer(theType){classCallCheck(this,NumberBuffer),validateType(theType),theType.signed=!theType.float&&theType.signed;var _this=possibleConstructorReturn(this,(NumberBuffer.__proto__||Object.getPrototypeOf(NumberBuffer)).call(this,theType.bits,theType.signed));return _this.offset=_this.parser.bytes,_this.parser.bytes=64===_this.parser.bits?4:_this.parser.bytes,_this.setReaderAndWriter_(theType),_this}return inherits(NumberBuffer,IntBuffer),createClass(NumberBuffer,[{key:"read16F_",value:function(bytes){return unpack$1(bytes,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,5,11)}},{key:"read32F_",value:function(bytes){return unpack$1(bytes,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,8,23)}},{key:"read64F_",value:function(bytes){return unpack$1(bytes,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,11,52)}},{key:"write16F_",value:function(bytes,num){return pack$1(bytes,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,num,5,11)}},{key:"write32F_",value:function(bytes,num){return pack$1(bytes,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,num,8,23)}},{key:"write64F_",value:function(bytes,num){return pack$1(bytes,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,num,11,52)}},{key:"setReaderAndWriter_",value:function(theType){theType.float?16==theType.bits?(this.unpack=this.read16F_,this.pack=this.write16F_):32==theType.bits?(this.unpack=this.read32F_,this.pack=this.write32F_):(this.unpack=this.read64F_,this.pack=this.write64F_):(this.unpack=get(NumberBuffer.prototype.__proto__||Object.getPrototypeOf(NumberBuffer.prototype),"unpack",this),this.pack=get(NumberBuffer.prototype.__proto__||Object.getPrototypeOf(NumberBuffer.prototype),"pack",this))}}]),NumberBuffer}();function unpackString(buffer){return function(buffer){var start=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,end=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;end=null!==end?end+1:buffer.length;for(var str="",index=start;index<end;){var lowerBoundary=128,upperBoundary=191,replace=!1,charCode=buffer[index++];if(charCode>=0&&charCode<=127)str+=String.fromCharCode(charCode);else{var count=0;charCode>=194&&charCode<=223?count=1:charCode>=224&&charCode<=239?(count=2,224===buffer[index]&&(lowerBoundary=160),237===buffer[index]&&(upperBoundary=159)):charCode>=240&&charCode<=244?(count=3,240===buffer[index]&&(lowerBoundary=144),244===buffer[index]&&(upperBoundary=143)):replace=!0,charCode&=(1<<8-count-1)-1;for(var i=0;i<count;i++)(buffer[index]<lowerBoundary||buffer[index]>upperBoundary)&&(replace=!0),charCode=charCode<<6|63&buffer[index],index++;replace?str+=String.fromCharCode(65533):charCode<=65535?str+=String.fromCharCode(charCode):(charCode-=65536,str+=String.fromCharCode(55296+(charCode>>10&1023),56320+(1023&charCode)))}}return str}(buffer,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}function packString(str){var buffer=new Uint8Array(function(str){for(var bytes=0,i=0,len=str.length;i<len;i++){var codePoint=str.codePointAt(i);codePoint<128?bytes++:(codePoint<=2047?bytes++:codePoint<=65535?bytes+=2:codePoint<=1114111&&(i++,bytes+=3),bytes++)}return bytes}(str));return pack(str,buffer,0),buffer}function packStringTo(str,buffer){return pack(str,buffer,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0)}function pack$2(value,theType){var output=[];return packTo(value,theType,output),output}function packTo(value,theType,buffer){return packArrayTo([value],theType,buffer,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function packArrayTo(values,theType,buffer){for(var index=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,packer=new NumberBuffer(theType),valuesLen=values.length,i=0;i<valuesLen;i++){validateValueType(values[i]);for(var len=index+packer.offset;index<len;)index=packer.pack(buffer,values[i],index);theType.be&&endianness(buffer,packer.offset,index-packer.offset,index)}return index}function unpack$2(buffer,theType){var index=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,packer=new NumberBuffer(theType);if(packer.offset+index>buffer.length)throw Error("Bad buffer length");theType.be&&endianness(buffer,packer.offset,index,index+packer.offset);var value=packer.unpack(buffer,index);return theType.be&&endianness(buffer,packer.offset,index,index+packer.offset),value}function unpackArray(buffer,theType){var output=[];return unpackArrayTo(buffer,theType,output,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,arguments.length>3&&void 0!==arguments[3]?arguments[3]:buffer.length),output}function unpackArrayTo(buffer,theType,output){for(var index=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,end=arguments.length>4&&void 0!==arguments[4]?arguments[4]:buffer.length,packer=new NumberBuffer(theType),originalIndex=index;(end-index)%packer.offset;)end--;theType.be&&endianness(buffer,packer.offset,index,end);for(var i=0;index<end;index+=packer.offset)output[i]=packer.unpack(buffer,index),i++;theType.be&&endianness(buffer,packer.offset,originalIndex,end)}var WAV_AUDIO_FORMATS={4:17,8:1,"8a":6,"8m":7,16:1,24:1,32:1,"32f":3,64:3};function makeWavHeader(bitDepthCode,numChannels,sampleRate,numBytes,samplesLength,options){return"4"==bitDepthCode?function(bitDepthCode,numChannels,sampleRate,numBytes,samplesLength,options){var header=createPCMHeader_(bitDepthCode,numChannels,sampleRate,numBytes,samplesLength,options);return header.chunkSize=40+samplesLength,header.fmt.chunkSize=20,header.fmt.byteRate=4055,header.fmt.blockAlign=256,header.fmt.bitsPerSample=4,header.fmt.cbSize=2,header.fmt.validBitsPerSample=505,header.fact={chunkId:"fact",chunkSize:4,dwSampleLength:2*samplesLength},header}(bitDepthCode,numChannels,sampleRate,numBytes,samplesLength,options):"8a"==bitDepthCode||"8m"==bitDepthCode?function(bitDepthCode,numChannels,sampleRate,numBytes,samplesLength,options){var header=createPCMHeader_(bitDepthCode,numChannels,sampleRate,numBytes,samplesLength,options);return header.chunkSize=40+samplesLength,header.fmt.chunkSize=20,header.fmt.cbSize=2,header.fmt.validBitsPerSample=8,header.fact={chunkId:"fact",chunkSize:4,dwSampleLength:samplesLength},header}(bitDepthCode,numChannels,sampleRate,numBytes,samplesLength,options):-1==Object.keys(WAV_AUDIO_FORMATS).indexOf(bitDepthCode)||numChannels>2?function(bitDepthCode,numChannels,sampleRate,numBytes,samplesLength,options){var header=createPCMHeader_(bitDepthCode,numChannels,sampleRate,numBytes,samplesLength,options);return header.chunkSize=60+samplesLength,header.fmt.chunkSize=40,header.fmt.bitsPerSample=1+(parseInt(bitDepthCode,10)-1|7),header.fmt.cbSize=22,header.fmt.validBitsPerSample=parseInt(bitDepthCode,10),header.fmt.dwChannelMask=function(numChannels){var dwChannelMask=0;return 1===numChannels?dwChannelMask=4:2===numChannels?dwChannelMask=3:4===numChannels?dwChannelMask=51:6===numChannels?dwChannelMask=63:8===numChannels&&(dwChannelMask=1599),dwChannelMask}(numChannels),header.fmt.subformat=[1,1048576,2852126848,1905997824],header}(bitDepthCode,numChannels,sampleRate,numBytes,samplesLength,options):createPCMHeader_(bitDepthCode,numChannels,sampleRate,numBytes,samplesLength,options)}function createPCMHeader_(bitDepthCode,numChannels,sampleRate,numBytes,samplesLength,options){return{container:options.container,chunkSize:36+samplesLength,format:"WAVE",bitDepth:bitDepthCode,fmt:{chunkId:"fmt ",chunkSize:16,audioFormat:WAV_AUDIO_FORMATS[bitDepthCode]||65534,numChannels:numChannels,sampleRate:sampleRate,byteRate:numChannels*numBytes*sampleRate,blockAlign:numChannels*numBytes,bitsPerSample:parseInt(bitDepthCode,10),cbSize:0,validBitsPerSample:0,dwChannelMask:0,subformat:[]}}}function validateWavHeader_(header){!function(header){if(!WAV_AUDIO_FORMATS[header.bitDepth]){if(parseInt(header.bitDepth,10)>8&&parseInt(header.bitDepth,10)<54)return!0;throw new Error("Invalid bit depth.")}}(header),function(header){var blockAlign=header.fmt.numChannels*header.fmt.bitsPerSample/8;if(header.fmt.numChannels<1||blockAlign>65535)throw new Error("Invalid number of channels.")}(header),function(header){var byteRate=header.fmt.numChannels*(header.fmt.bitsPerSample/8)*header.fmt.sampleRate;if(header.fmt.sampleRate<1||byteRate>4294967295)throw new Error("Invalid sample rate.")}(header)}var BufferIO=function(){function BufferIO(){classCallCheck(this,BufferIO),this.head_=0}return createClass(BufferIO,[{key:"writeString_",value:function(str,maxSize){var push=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],bytes=Array.prototype.slice.call(packString(str));if(push)for(var i=bytes.length;i<maxSize;i++)bytes.push(0);return bytes}},{key:"readZSTR_",value:function(bytes){for(var str="",i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;i<bytes.length&&(this.head_++,0!==bytes[i]);i++)str+=unpackString(bytes,i,i);return str}},{key:"readString_",value:function(bytes,maxSize){var str;return str=unpackString(bytes,this.head_,this.head_+maxSize-1),this.head_+=maxSize,str}},{key:"read_",value:function(bytes,bdType){var size=bdType.bits/8,value=unpack$2(bytes,bdType,this.head_);return this.head_+=size,value}}]),BufferIO}(),io=new BufferIO;function writeWavBuffer(wav){var uInt32_={bits:32,be:!1},uInt16_={bits:16,be:!1};uInt16_.be="RIFX"===wav.container,uInt32_.be=uInt16_.be;for(var fileBody=[function(wav,uInt32_){var bytes=[];if(wav.junk.chunkId)return bytes.concat(Array.prototype.slice.call(packString(wav.junk.chunkId)),pack$2(wav.junk.chunkData.length,uInt32_),wav.junk.chunkData);return bytes}(wav,uInt32_),function(wav,uInt32_){var bytes=[];wav.ds64.chunkId&&(bytes=bytes.concat(Array.prototype.slice.call(packString(wav.ds64.chunkId)),pack$2(wav.ds64.chunkSize,uInt32_),pack$2(wav.ds64.riffSizeHigh,uInt32_),pack$2(wav.ds64.riffSizeLow,uInt32_),pack$2(wav.ds64.dataSizeHigh,uInt32_),pack$2(wav.ds64.dataSizeLow,uInt32_),pack$2(wav.ds64.originationTime,uInt32_),pack$2(wav.ds64.sampleCountHigh,uInt32_),pack$2(wav.ds64.sampleCountLow,uInt32_)));return bytes}(wav,uInt32_),function(wav,uInt32_,uInt16_){var bytes=[];(function(wav){for(var prop in wav.bext)if(wav.bext.hasOwnProperty(prop)&&wav.bext[prop]&&"timeReference"!=prop){wav.bext.chunkId="bext";break}(wav.bext.timeReference[0]||wav.bext.timeReference[1])&&(wav.bext.chunkId="bext")})(wav),wav.bext.chunkId&&(wav.bext.chunkSize=602+wav.bext.codingHistory.length,bytes=bytes.concat(Array.prototype.slice.call(packString(wav.bext.chunkId)),pack$2(602+wav.bext.codingHistory.length,uInt32_),io.writeString_(wav.bext.description,256),io.writeString_(wav.bext.originator,32),io.writeString_(wav.bext.originatorReference,32),io.writeString_(wav.bext.originationDate,10),io.writeString_(wav.bext.originationTime,8),pack$2(wav.bext.timeReference[0],uInt32_),pack$2(wav.bext.timeReference[1],uInt32_),pack$2(wav.bext.version,uInt16_),Array.prototype.slice.call(io.writeString_(wav.bext.UMID,64)),pack$2(wav.bext.loudnessValue,uInt16_),pack$2(wav.bext.loudnessRange,uInt16_),pack$2(wav.bext.maxTruePeakLevel,uInt16_),pack$2(wav.bext.maxMomentaryLoudness,uInt16_),pack$2(wav.bext.maxShortTermLoudness,uInt16_),io.writeString_(wav.bext.reserved,180),io.writeString_(wav.bext.codingHistory,wav.bext.codingHistory.length)));return bytes}(wav,uInt32_,uInt16_),function(wav,uInt32_,uInt16_){if(wav.fmt.chunkId)return[].concat(Array.prototype.slice.call(packString(wav.fmt.chunkId)),pack$2(wav.fmt.chunkSize,uInt32_),pack$2(wav.fmt.audioFormat,uInt16_),pack$2(wav.fmt.numChannels,uInt16_),pack$2(wav.fmt.sampleRate,uInt32_),pack$2(wav.fmt.byteRate,uInt32_),pack$2(wav.fmt.blockAlign,uInt16_),pack$2(wav.fmt.bitsPerSample,uInt16_),function(wav,uInt32_,uInt16_){var extension=[];wav.fmt.chunkSize>16&&(extension=extension.concat(pack$2(wav.fmt.cbSize,uInt16_)));wav.fmt.chunkSize>18&&(extension=extension.concat(pack$2(wav.fmt.validBitsPerSample,uInt16_)));wav.fmt.chunkSize>20&&(extension=extension.concat(pack$2(wav.fmt.dwChannelMask,uInt32_)));wav.fmt.chunkSize>24&&(extension=extension.concat(pack$2(wav.fmt.subformat[0],uInt32_),pack$2(wav.fmt.subformat[1],uInt32_),pack$2(wav.fmt.subformat[2],uInt32_),pack$2(wav.fmt.subformat[3],uInt32_)));return extension}(wav,uInt32_,uInt16_));throw Error('Could not find the "fmt " chunk')}(wav,uInt32_,uInt16_),function(wav,uInt32_){var bytes=[];wav.fact.chunkId&&(bytes=bytes.concat(Array.prototype.slice.call(packString(wav.fact.chunkId)),pack$2(wav.fact.chunkSize,uInt32_),pack$2(wav.fact.dwSampleLength,uInt32_)));return bytes}(wav,uInt32_),Array.prototype.slice.call(packString(wav.data.chunkId)),pack$2(wav.data.samples.length,uInt32_),wav.data.samples,function(wav,uInt32_){var bytes=[];if(wav.cue.chunkId){var cuePointsBytes=function(wav,uInt32_){for(var points=[],i=0;i<wav.cue.dwCuePoints;i++)points=points.concat(pack$2(wav.cue.points[i].dwName,uInt32_),pack$2(wav.cue.points[i].dwPosition,uInt32_),Array.prototype.slice.call(packString(wav.cue.points[i].fccChunk)),pack$2(wav.cue.points[i].dwChunkStart,uInt32_),pack$2(wav.cue.points[i].dwBlockStart,uInt32_),pack$2(wav.cue.points[i].dwSampleOffset,uInt32_));return points}(wav,uInt32_);bytes=bytes.concat(Array.prototype.slice.call(packString(wav.cue.chunkId)),pack$2(cuePointsBytes.length+4,uInt32_),pack$2(wav.cue.dwCuePoints,uInt32_),cuePointsBytes)}return bytes}(wav,uInt32_),function(wav,uInt32_){var bytes=[];if(wav.smpl.chunkId){var smplLoopsBytes=function(wav,uInt32_){for(var loops=[],i=0;i<wav.smpl.dwNumSampleLoops;i++)loops=loops.concat(pack$2(wav.smpl.loops[i].dwName,uInt32_),pack$2(wav.smpl.loops[i].dwType,uInt32_),pack$2(wav.smpl.loops[i].dwStart,uInt32_),pack$2(wav.smpl.loops[i].dwEnd,uInt32_),pack$2(wav.smpl.loops[i].dwFraction,uInt32_),pack$2(wav.smpl.loops[i].dwPlayCount,uInt32_));return loops}(wav,uInt32_);bytes=bytes.concat(Array.prototype.slice.call(packString(wav.smpl.chunkId)),pack$2(smplLoopsBytes.length+36,uInt32_),pack$2(wav.smpl.dwManufacturer,uInt32_),pack$2(wav.smpl.dwProduct,uInt32_),pack$2(wav.smpl.dwSamplePeriod,uInt32_),pack$2(wav.smpl.dwMIDIUnityNote,uInt32_),pack$2(wav.smpl.dwMIDIPitchFraction,uInt32_),pack$2(wav.smpl.dwSMPTEFormat,uInt32_),pack$2(wav.smpl.dwSMPTEOffset,uInt32_),pack$2(wav.smpl.dwNumSampleLoops,uInt32_),pack$2(wav.smpl.dwSamplerData,uInt32_),smplLoopsBytes)}return bytes}(wav,uInt32_),function(wav,uInt32_,uInt16_){for(var bytes=[],i=0;i<wav.LIST.length;i++){var subChunksBytes=getLISTSubChunksBytes_(wav.LIST[i].subChunks,wav.LIST[i].format,wav,uInt32_,uInt16_);bytes=bytes.concat(Array.prototype.slice.call(packString(wav.LIST[i].chunkId)),pack$2(subChunksBytes.length+4,uInt32_),Array.prototype.slice.call(packString(wav.LIST[i].format)),subChunksBytes)}return bytes}(wav,uInt32_,uInt16_)],fileBodyLength=0,i=0;i<fileBody.length;i++)fileBodyLength+=fileBody[i].length;var file=new Uint8Array(fileBodyLength+12),index=0;index=packTo(fileBodyLength+4,uInt32_,file,index=packStringTo(wav.container,file,index)),index=packStringTo(wav.format,file,index);for(var _i=0;_i<fileBody.length;_i++)file.set(fileBody[_i],index),index+=fileBody[_i].length;return file}function getLISTSubChunksBytes_(subChunks,format,wav,uInt32_,uInt16_){for(var bytes=[],i=0;i<subChunks.length;i++)"INFO"==format?(bytes=bytes.concat(Array.prototype.slice.call(packString(subChunks[i].chunkId)),pack$2(subChunks[i].value.length+1,uInt32_),io.writeString_(subChunks[i].value,subChunks[i].value.length))).push(0):"adtl"==format&&(["labl","note"].indexOf(subChunks[i].chunkId)>-1?(bytes=bytes.concat(Array.prototype.slice.call(packString(subChunks[i].chunkId)),pack$2(subChunks[i].value.length+4+1,uInt32_),pack$2(subChunks[i].dwName,uInt32_),io.writeString_(subChunks[i].value,subChunks[i].value.length))).push(0):"ltxt"==subChunks[i].chunkId&&(bytes=bytes.concat(getLtxtChunkBytes_(subChunks[i],wav,uInt32_,uInt16_)))),bytes.length%2&&bytes.push(0);return bytes}function getLtxtChunkBytes_(ltxt,wav,uInt32_,uInt16_){return[].concat(Array.prototype.slice.call(packString(ltxt.chunkId)),pack$2(ltxt.value.length+20,uInt32_),pack$2(ltxt.dwName,uInt32_),pack$2(ltxt.dwSampleLength,uInt32_),pack$2(ltxt.dwPurposeID,uInt32_),pack$2(ltxt.dwCountry,uInt16_),pack$2(ltxt.dwLanguage,uInt16_),pack$2(ltxt.dwDialect,uInt16_),pack$2(ltxt.dwCodePage,uInt16_),io.writeString_(ltxt.value,ltxt.value.length))}var uInt32_={bits:32},head_=0;function riffChunks(buffer){head_=0;var chunkId=getChunkId_(buffer,0);uInt32_.be="RIFX"==chunkId;var format=unpackString(buffer,8,11);return head_+=4,{chunkId:chunkId,chunkSize:getChunkSize_(buffer,0),format:format,subChunks:getSubChunksIndex_(buffer)}}function findChunk(chunks,chunkId){for(var multiple=arguments.length>2&&void 0!==arguments[2]&&arguments[2],chunk=[],i=0;i<chunks.length;i++)if(chunks[i].chunkId==chunkId){if(!multiple)return chunks[i];chunk.push(chunks[i])}return"LIST"==chunkId&&chunk.length?chunk:null}function getSubChunksIndex_(buffer){for(var chunks=[],i=head_;i<=buffer.length-8;)chunks.push(getSubChunkIndex_(buffer,i)),i=(i+=8+chunks[chunks.length-1].chunkSize)%2?i+1:i;return chunks}function getSubChunkIndex_(buffer,index){var chunk={chunkId:getChunkId_(buffer,index),chunkSize:getChunkSize_(buffer,index)};if("LIST"==chunk.chunkId)chunk.format=unpackString(buffer,index+8,index+11),head_+=4,chunk.subChunks=getSubChunksIndex_(buffer);else{var realChunkSize=chunk.chunkSize%2?chunk.chunkSize+1:chunk.chunkSize;head_=index+8+realChunkSize,chunk.chunkData={start:index+8,end:head_}}return chunk}function getChunkId_(buffer,index){return head_+=4,unpackString(buffer,index,index+3)}function getChunkSize_(buffer,index){return head_+=4,unpack$2(buffer,uInt32_,index+4)}var io$1=new BufferIO;function readWavBuffer(buffer,samples,wav){io$1.head_=0;var uInt32_={bits:32,be:!1},uInt16_={bits:16,be:!1};!function(bytes,wav,uInt32_,uInt16_){if(io$1.head_=0,wav.container=io$1.readString_(bytes,4),-1===["RIFF","RIFX","RF64"].indexOf(wav.container))throw Error("Not a supported format.");if(uInt16_.be="RIFX"===wav.container,uInt32_.be=uInt16_.be,wav.chunkSize=io$1.read_(bytes,uInt32_),wav.format=io$1.readString_(bytes,4),"WAVE"!=wav.format)throw Error('Could not find the "WAVE" format identifier')}(buffer,wav,uInt32_,uInt16_);var chunk=riffChunks(buffer);!function(buffer,signature,wav,uInt32_){var chunk=findChunk(signature,"ds64");if(chunk)io$1.head_=chunk.chunkData.start,wav.ds64.chunkId=chunk.chunkId,wav.ds64.chunkSize=chunk.chunkSize,wav.ds64.riffSizeHigh=io$1.read_(buffer,uInt32_),wav.ds64.riffSizeLow=io$1.read_(buffer,uInt32_),wav.ds64.dataSizeHigh=io$1.read_(buffer,uInt32_),wav.ds64.dataSizeLow=io$1.read_(buffer,uInt32_),wav.ds64.originationTime=io$1.read_(buffer,uInt32_),wav.ds64.sampleCountHigh=io$1.read_(buffer,uInt32_),wav.ds64.sampleCountLow=io$1.read_(buffer,uInt32_);else if("RF64"==wav.container)throw Error('Could not find the "ds64" chunk')}(buffer,chunk.subChunks,wav,uInt32_),function(buffer,signature,wav,uInt32_,uInt16_){var chunk=findChunk(signature,"fmt ");if(!chunk)throw Error('Could not find the "fmt " chunk');io$1.head_=chunk.chunkData.start,wav.fmt.chunkId=chunk.chunkId,wav.fmt.chunkSize=chunk.chunkSize,wav.fmt.audioFormat=io$1.read_(buffer,uInt16_),wav.fmt.numChannels=io$1.read_(buffer,uInt16_),wav.fmt.sampleRate=io$1.read_(buffer,uInt32_),wav.fmt.byteRate=io$1.read_(buffer,uInt32_),wav.fmt.blockAlign=io$1.read_(buffer,uInt16_),wav.fmt.bitsPerSample=io$1.read_(buffer,uInt16_),function(buffer,wav,uInt32_,uInt16_){wav.fmt.chunkSize>16&&(wav.fmt.cbSize=io$1.read_(buffer,uInt16_),wav.fmt.chunkSize>18&&(wav.fmt.validBitsPerSample=io$1.read_(buffer,uInt16_),wav.fmt.chunkSize>20&&(wav.fmt.dwChannelMask=io$1.read_(buffer,uInt32_),wav.fmt.subformat=[io$1.read_(buffer,uInt32_),io$1.read_(buffer,uInt32_),io$1.read_(buffer,uInt32_),io$1.read_(buffer,uInt32_)])))}(buffer,wav,uInt32_,uInt16_)}(buffer,chunk.subChunks,wav,uInt32_,uInt16_),function(buffer,signature,wav,uInt32_){var chunk=findChunk(signature,"fact");chunk&&(io$1.head_=chunk.chunkData.start,wav.fact.chunkId=chunk.chunkId,wav.fact.chunkSize=chunk.chunkSize,wav.fact.dwSampleLength=io$1.read_(buffer,uInt32_))}(buffer,chunk.subChunks,wav,uInt32_),function(buffer,signature,wav,uInt32_,uInt16_){var chunk=findChunk(signature,"bext");chunk&&(io$1.head_=chunk.chunkData.start,wav.bext.chunkId=chunk.chunkId,wav.bext.chunkSize=chunk.chunkSize,wav.bext.description=io$1.readString_(buffer,256),wav.bext.originator=io$1.readString_(buffer,32),wav.bext.originatorReference=io$1.readString_(buffer,32),wav.bext.originationDate=io$1.readString_(buffer,10),wav.bext.originationTime=io$1.readString_(buffer,8),wav.bext.timeReference=[io$1.read_(buffer,uInt32_),io$1.read_(buffer,uInt32_)],wav.bext.version=io$1.read_(buffer,uInt16_),wav.bext.UMID=io$1.readString_(buffer,64),wav.bext.loudnessValue=io$1.read_(buffer,uInt16_),wav.bext.loudnessRange=io$1.read_(buffer,uInt16_),wav.bext.maxTruePeakLevel=io$1.read_(buffer,uInt16_),wav.bext.maxMomentaryLoudness=io$1.read_(buffer,uInt16_),wav.bext.maxShortTermLoudness=io$1.read_(buffer,uInt16_),wav.bext.reserved=io$1.readString_(buffer,180),wav.bext.codingHistory=io$1.readString_(buffer,wav.bext.chunkSize-602))}(buffer,chunk.subChunks,wav,uInt32_,uInt16_),function(buffer,signature,wav,uInt32_){var chunk=findChunk(signature,"cue ");if(chunk){io$1.head_=chunk.chunkData.start,wav.cue.chunkId=chunk.chunkId,wav.cue.chunkSize=chunk.chunkSize,wav.cue.dwCuePoints=io$1.read_(buffer,uInt32_);for(var i=0;i<wav.cue.dwCuePoints;i++)wav.cue.points.push({dwName:io$1.read_(buffer,uInt32_),dwPosition:io$1.read_(buffer,uInt32_),fccChunk:io$1.readString_(buffer,4),dwChunkStart:io$1.read_(buffer,uInt32_),dwBlockStart:io$1.read_(buffer,uInt32_),dwSampleOffset:io$1.read_(buffer,uInt32_)})}}(buffer,chunk.subChunks,wav,uInt32_),function(buffer,signature,wav,uInt32_){var chunk=findChunk(signature,"smpl");if(chunk){io$1.head_=chunk.chunkData.start,wav.smpl.chunkId=chunk.chunkId,wav.smpl.chunkSize=chunk.chunkSize,wav.smpl.dwManufacturer=io$1.read_(buffer,uInt32_),wav.smpl.dwProduct=io$1.read_(buffer,uInt32_),wav.smpl.dwSamplePeriod=io$1.read_(buffer,uInt32_),wav.smpl.dwMIDIUnityNote=io$1.read_(buffer,uInt32_),wav.smpl.dwMIDIPitchFraction=io$1.read_(buffer,uInt32_),wav.smpl.dwSMPTEFormat=io$1.read_(buffer,uInt32_),wav.smpl.dwSMPTEOffset=io$1.read_(buffer,uInt32_),wav.smpl.dwNumSampleLoops=io$1.read_(buffer,uInt32_),wav.smpl.dwSamplerData=io$1.read_(buffer,uInt32_);for(var i=0;i<wav.smpl.dwNumSampleLoops;i++)wav.smpl.loops.push({dwName:io$1.read_(buffer,uInt32_),dwType:io$1.read_(buffer,uInt32_),dwStart:io$1.read_(buffer,uInt32_),dwEnd:io$1.read_(buffer,uInt32_),dwFraction:io$1.read_(buffer,uInt32_),dwPlayCount:io$1.read_(buffer,uInt32_)})}}(buffer,chunk.subChunks,wav,uInt32_),function(buffer,signature,samples,wav){var chunk=findChunk(signature,"data");if(!chunk)throw Error('Could not find the "data" chunk');wav.data.chunkId="data",wav.data.chunkSize=chunk.chunkSize,samples&&(wav.data.samples=buffer.slice(chunk.chunkData.start,chunk.chunkData.end))}(buffer,chunk.subChunks,samples,wav),function(buffer,signature,wav){var chunk=findChunk(signature,"junk");chunk&&(wav.junk={chunkId:chunk.chunkId,chunkSize:chunk.chunkSize,chunkData:[].slice.call(buffer.slice(chunk.chunkData.start,chunk.chunkData.end))})}(buffer,chunk.subChunks,wav),function(buffer,signature,wav,uInt32_,uInt16_){var listChunks=findChunk(signature,"LIST",!0);if(null===listChunks)return;for(var j=0;j<listChunks.length;j++){var subChunk=listChunks[j];wav.LIST.push({chunkId:subChunk.chunkId,chunkSize:subChunk.chunkSize,format:subChunk.format,subChunks:[]});for(var x=0;x<subChunk.subChunks.length;x++)readLISTSubChunks_(subChunk.subChunks[x],subChunk.format,buffer,wav,uInt32_,uInt16_)}}(buffer,chunk.subChunks,wav,uInt32_,uInt16_)}function readLISTSubChunks_(subChunk,format,buffer,wav,uInt32_,uInt16_){if("adtl"==format){if(["labl","note","ltxt"].indexOf(subChunk.chunkId)>-1){io$1.head_=subChunk.chunkData.start;var item={chunkId:subChunk.chunkId,chunkSize:subChunk.chunkSize,dwName:io$1.read_(buffer,uInt32_)};"ltxt"==subChunk.chunkId&&(item.dwSampleLength=io$1.read_(buffer,uInt32_),item.dwPurposeID=io$1.read_(buffer,uInt32_),item.dwCountry=io$1.read_(buffer,uInt16_),item.dwLanguage=io$1.read_(buffer,uInt16_),item.dwDialect=io$1.read_(buffer,uInt16_),item.dwCodePage=io$1.read_(buffer,uInt16_)),item.value=io$1.readZSTR_(buffer,io$1.head_),wav.LIST[wav.LIST.length-1].subChunks.push(item)}}else"INFO"==format&&(io$1.head_=subChunk.chunkData.start,wav.LIST[wav.LIST.length-1].subChunks.push({chunkId:subChunk.chunkId,chunkSize:subChunk.chunkSize,value:io$1.readZSTR_(buffer,io$1.head_)}))}var WavBuffer=function WavBuffer(){classCallCheck(this,WavBuffer),this.container="",this.chunkSize=0,this.format="",this.fmt={chunkId:"",chunkSize:0,audioFormat:0,numChannels:0,sampleRate:0,byteRate:0,blockAlign:0,bitsPerSample:0,cbSize:0,validBitsPerSample:0,dwChannelMask:0,subformat:[]},this.fact={chunkId:"",chunkSize:0,dwSampleLength:0},this.cue={chunkId:"",chunkSize:0,dwCuePoints:0,points:[]},this.smpl={chunkId:"",chunkSize:0,dwManufacturer:0,dwProduct:0,dwSamplePeriod:0,dwMIDIUnityNote:0,dwMIDIPitchFraction:0,dwSMPTEFormat:0,dwSMPTEOffset:0,dwNumSampleLoops:0,dwSamplerData:0,loops:[]},this.bext={chunkId:"",chunkSize:0,description:"",originator:"",originatorReference:"",originationDate:"",originationTime:"",timeReference:[0,0],version:0,UMID:"",loudnessValue:0,loudnessRange:0,maxTruePeakLevel:0,maxMomentaryLoudness:0,maxShortTermLoudness:0,reserved:"",codingHistory:""},this.ds64={chunkId:"",chunkSize:0,riffSizeHigh:0,riffSizeLow:0,dataSizeHigh:0,dataSizeLow:0,originationTime:0,sampleCountHigh:0,sampleCountLow:0},this.data={chunkId:"",chunkSize:0,samples:new Uint8Array(0)},this.LIST=[],this.junk={chunkId:"",chunkSize:0,chunkData:[]}};return function(_WavBuffer){function WaveFile(){var bytes=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;classCallCheck(this,WaveFile);var _this=possibleConstructorReturn(this,(WaveFile.__proto__||Object.getPrototypeOf(WaveFile)).call(this));return _this.bitDepth="0",_this.dataType={},bytes&&_this.fromBuffer(bytes),_this}return inherits(WaveFile,WavBuffer),createClass(WaveFile,[{key:"getSample",value:function(index){if((index*=this.dataType.bits/8)+this.dataType.bits/8>this.data.samples.length)throw new Error("Range error");return unpack$2(this.data.samples.slice(index,index+this.dataType.bits/8),this.dataType)}},{key:"setSample",value:function(index,sample){if((index*=this.dataType.bits/8)+this.dataType.bits/8>this.data.samples.length)throw new Error("Range error");packTo(sample,this.dataType,this.data.samples,index)}},{key:"fromScratch",value:function(numChannels,sampleRate,bitDepthCode,samples){var options=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};options.container||(options.container="RIFF"),this.container=options.container,this.bitDepth=bitDepthCode,samples=this.interleave_(samples),this.updateDataType_();var numBytes=this.dataType.bits/8;this.data.samples=new Uint8Array(samples.length*numBytes),packArrayTo(samples,this.dataType,this.data.samples);var header=makeWavHeader(bitDepthCode,numChannels,sampleRate,numBytes,this.data.samples.length,options);this.clearHeader_(),this.chunkSize=header.chunkSize,this.format=header.format,this.fmt=header.fmt,header.fact&&(this.fact=header.fact),this.data.chunkId="data",this.data.chunkSize=this.data.samples.length,validateWavHeader_(this)}},{key:"fromBuffer",value:function(bytes){var samples=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.clearHeader_(),readWavBuffer(bytes,samples,this),this.bitDepthFromFmt_(),this.updateDataType_()}},{key:"toBuffer",value:function(){return validateWavHeader_(this),writeWavBuffer(this)}},{key:"fromBase64",value:function(base64String){this.fromBuffer(new Uint8Array(function(base64){var len=base64.length,bufferLength=.75*base64.length,p=0,encoded1=void 0,encoded2=void 0,encoded3=void 0,encoded4=void 0;"="===base64[base64.length-1]&&(bufferLength--,"="===base64[base64.length-2]&&bufferLength--);for(var arraybuffer=new ArrayBuffer(bufferLength),bytes=new Uint8Array(arraybuffer),_i2=0;_i2<len;_i2+=4)encoded1=lookup[base64.charCodeAt(_i2)],encoded2=lookup[base64.charCodeAt(_i2+1)],encoded3=lookup[base64.charCodeAt(_i2+2)],encoded4=lookup[base64.charCodeAt(_i2+3)],bytes[p++]=encoded1<<2|encoded2>>4,bytes[p++]=(15&encoded2)<<4|encoded3>>2,bytes[p++]=(3&encoded3)<<6|63&encoded4;return arraybuffer}(base64String)))}},{key:"toBase64",value:function(){var buffer=this.toBuffer();return function(arraybuffer,byteOffset,length){for(var bytes=new Uint8Array(arraybuffer,byteOffset,length),len=bytes.length,base64="",_i=0;_i<len;_i+=3)base64+=chars[bytes[_i]>>2],base64+=chars[(3&bytes[_i])<<4|bytes[_i+1]>>4],base64+=chars[(15&bytes[_i+1])<<2|bytes[_i+2]>>6],base64+=chars[63&bytes[_i+2]];return len%3==2?base64=base64.substring(0,base64.length-1)+"=":len%3==1&&(base64=base64.substring(0,base64.length-2)+"=="),base64}(buffer,0,buffer.length)}},{key:"toDataURI",value:function(){return"data:audio/wav;base64,"+this.toBase64()}},{key:"fromDataURI",value:function(dataURI){this.fromBase64(dataURI.replace("data:audio/wav;base64,",""))}},{key:"toRIFF",value:function(){this.fromScratch(this.fmt.numChannels,this.fmt.sampleRate,this.bitDepth,unpackArray(this.data.samples,this.dataType))}},{key:"toRIFX",value:function(){this.fromScratch(this.fmt.numChannels,this.fmt.sampleRate,this.bitDepth,unpackArray(this.data.samples,this.dataType),{container:"RIFX"})}},{key:"toBitDepth",value:function(newBitDepth){var changeResolution=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],toBitDepth=newBitDepth,thisBitDepth=this.bitDepth;changeResolution||("32f"!=newBitDepth&&(toBitDepth=this.dataType.bits.toString()),thisBitDepth=this.dataType.bits),this.assureUncompressed_();var sampleCount=this.data.samples.length/(this.dataType.bits/8),typedSamplesInput=new Float64Array(sampleCount+1),typedSamplesOutput=new Float64Array(sampleCount+1);unpackArrayTo(this.data.samples,this.dataType,typedSamplesInput),"32f"!=thisBitDepth&&"64"!=thisBitDepth||this.truncateSamples_(typedSamplesInput),bitDepth(typedSamplesInput,thisBitDepth,toBitDepth,typedSamplesOutput),this.fromScratch(this.fmt.numChannels,this.fmt.sampleRate,newBitDepth,typedSamplesOutput,{container:this.correctContainer_()})}},{key:"toIMAADPCM",value:function(){if(8e3!==this.fmt.sampleRate)throw new Error("Only 8000 Hz files can be compressed as IMA-ADPCM.");if(1!==this.fmt.numChannels)throw new Error("Only mono files can be compressed as IMA-ADPCM.");this.assure16Bit_();var output=new Int16Array(this.data.samples.length/2);unpackArrayTo(this.data.samples,this.dataType,output),this.fromScratch(this.fmt.numChannels,this.fmt.sampleRate,"4",function(samples){for(var adpcmSamples=new Uint8Array(samples.length/2+512),block=[],fileIndex=0,i=0;i<samples.length;i++)i%505==0&&0!=i&&(adpcmSamples.set(encodeBlock(block),fileIndex),fileIndex+=256,block=[]),block.push(samples[i]);return adpcmSamples}(output),{container:this.correctContainer_()})}},{key:"fromIMAADPCM",value:function(){var bitDepthCode=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"16";this.fromScratch(this.fmt.numChannels,this.fmt.sampleRate,"16",function(adpcmSamples){for(var blockAlign=arguments.length>1&&void 0!==arguments[1]?arguments[1]:256,samples=new Int16Array(2*adpcmSamples.length),block=[],fileIndex=0,i=0;i<adpcmSamples.length;i++)i%blockAlign==0&&0!=i&&(samples.set(decodeBlock(block),fileIndex),fileIndex+=2*blockAlign,block=[]),block.push(adpcmSamples[i]);return samples}(this.data.samples,this.fmt.blockAlign),{container:this.correctContainer_()}),"16"!=bitDepthCode&&this.toBitDepth(bitDepthCode)}},{key:"toALaw",value:function(){this.assure16Bit_();var output=new Int16Array(this.data.samples.length/2);unpackArrayTo(this.data.samples,this.dataType,output),this.fromScratch(this.fmt.numChannels,this.fmt.sampleRate,"8a",function(samples){for(var aLawSamples=new Uint8Array(samples.length),i=0;i<samples.length;i++)aLawSamples[i]=encodeSample(samples[i]);return aLawSamples}(output),{container:this.correctContainer_()})}},{key:"fromALaw",value:function(){var bitDepthCode=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"16";this.fromScratch(this.fmt.numChannels,this.fmt.sampleRate,"16",function(samples){for(var pcmSamples=new Int16Array(samples.length),i=0;i<samples.length;i++)pcmSamples[i]=decodeSample(samples[i]);return pcmSamples}(this.data.samples),{container:this.correctContainer_()}),"16"!=bitDepthCode&&this.toBitDepth(bitDepthCode)}},{key:"toMuLaw",value:function(){this.assure16Bit_();var output=new Int16Array(this.data.samples.length/2);unpackArrayTo(this.data.samples,this.dataType,output),this.fromScratch(this.fmt.numChannels,this.fmt.sampleRate,"8m",function(samples){for(var sample,sign,exponent,muLawSamples=new Uint8Array(samples.length),i=0;i<samples.length;i++)muLawSamples[i]=(sample=samples[i],sign=void 0,exponent=void 0,0!=(sign=sample>>8&128)&&(sample=-sample),sample>CLIP&&(sample=CLIP),~(sign|(exponent=encodeTable[(sample+=BIAS)>>7&255])<<4|sample>>exponent+3&15));return muLawSamples}(output),{container:this.correctContainer_()})}},{key:"fromMuLaw",value:function(){var bitDepthCode=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"16";this.fromScratch(this.fmt.numChannels,this.fmt.sampleRate,"16",function(samples){for(var muLawSample,sign,exponent,mantissa,sample,pcmSamples=new Int16Array(samples.length),i=0;i<samples.length;i++)pcmSamples[i]=(muLawSample=samples[i],sign=void 0,exponent=void 0,mantissa=void 0,sample=void 0,sample=void 0,sign=128&(muLawSample=~muLawSample),mantissa=15&muLawSample,sample=decodeTable[exponent=muLawSample>>4&7]+(mantissa<<exponent+3),0!=sign&&(sample=-sample),sample);return pcmSamples}(this.data.samples),{container:this.correctContainer_()}),"16"!=bitDepthCode&&this.toBitDepth(bitDepthCode)}},{key:"setTag",value:function(tag,value){tag=this.fixTagName_(tag);var index=this.getTagIndex_(tag);null!==index.TAG?(this.LIST[index.LIST].subChunks[index.TAG].chunkSize=value.length+1,this.LIST[index.LIST].subChunks[index.TAG].value=value):null!==index.LIST?this.LIST[index.LIST].subChunks.push({chunkId:tag,chunkSize:value.length+1,value:value}):(this.LIST.push({chunkId:"LIST",chunkSize:8+value.length+1,format:"INFO",subChunks:[]}),this.LIST[this.LIST.length-1].subChunks.push({chunkId:tag,chunkSize:value.length+1,value:value}))}},{key:"getTag",value:function(tag){var index=this.getTagIndex_(tag);return null!==index.TAG?this.LIST[index.LIST].subChunks[index.TAG].value:null}},{key:"listTags",value:function(){var index=this.getLISTINFOIndex_(),tags={};if(null!==index)for(var i=0,len=this.LIST[index].subChunks.length;i<len;i++)tags[this.LIST[index].subChunks[i].chunkId]=this.LIST[index].subChunks[i].value;return tags}},{key:"deleteTag",value:function(tag){var index=this.getTagIndex_(tag);return null!==index.TAG&&(this.LIST[index.LIST].subChunks.splice(index.TAG,1),!0)}},{key:"setCuePoint",value:function(position){var labl=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";this.cue.chunkId="cue ",position=position*this.fmt.sampleRate/1e3;var existingPoints=this.getCuePoints_();this.clearLISTadtl_();var len=this.cue.points.length;this.cue.points=[];var hasSet=!1;if(0===len)this.setCuePoint_(position,1,labl);else{for(var i=0;i<len;i++)existingPoints[i].dwPosition>position&&!hasSet?(this.setCuePoint_(position,i+1,labl),this.setCuePoint_(existingPoints[i].dwPosition,i+2,existingPoints[i].label),hasSet=!0):this.setCuePoint_(existingPoints[i].dwPosition,i+1,existingPoints[i].label);hasSet||this.setCuePoint_(position,this.cue.points.length+1,labl)}this.cue.dwCuePoints=this.cue.points.length}},{key:"deleteCuePoint",value:function(index){this.cue.chunkId="cue ";var existingPoints=this.getCuePoints_();this.clearLISTadtl_();var len=this.cue.points.length;this.cue.points=[];for(var i=0;i<len;i++)i+1!==index&&this.setCuePoint_(existingPoints[i].dwPosition,i+1,existingPoints[i].label);this.cue.dwCuePoints=this.cue.points.length,this.cue.dwCuePoints?this.cue.chunkId="cue ":(this.cue.chunkId="",this.clearLISTadtl_())}},{key:"listCuePoints",value:function(){for(var points=this.getCuePoints_(),i=0,len=points.length;i<len;i++)points[i].milliseconds=points[i].dwPosition/this.fmt.sampleRate*1e3;return points}},{key:"updateLabel",value:function(pointIndex,label){var cIndex=this.getAdtlChunk_();if(null!==cIndex)for(var i=0,len=this.LIST[cIndex].subChunks.length;i<len;i++)this.LIST[cIndex].subChunks[i].dwName==pointIndex&&(this.LIST[cIndex].subChunks[i].value=label)}},{key:"bitDepthFromFmt_",value:function(){3===this.fmt.audioFormat&&32===this.fmt.bitsPerSample?this.bitDepth="32f":6===this.fmt.audioFormat?this.bitDepth="8a":7===this.fmt.audioFormat?this.bitDepth="8m":this.bitDepth=this.fmt.bitsPerSample.toString()}},{key:"setCuePoint_",value:function(position,dwName,label){this.cue.points.push({dwName:dwName,dwPosition:position,fccChunk:"data",dwChunkStart:0,dwBlockStart:0,dwSampleOffset:position}),this.setLabl_(dwName,label)}},{key:"getCuePoints_",value:function(){for(var points=[],i=0,len=this.cue.points.length;i<len;i++)points.push({dwPosition:this.cue.points[i].dwPosition,label:this.getLabelForCuePoint_(this.cue.points[i].dwName)});return points}},{key:"getLabelForCuePoint_",value:function(pointDwName){var cIndex=this.getAdtlChunk_();if(null!==cIndex)for(var i=0,len=this.LIST[cIndex].subChunks.length;i<len;i++)if(this.LIST[cIndex].subChunks[i].dwName==pointDwName)return this.LIST[cIndex].subChunks[i].value;return""}},{key:"clearLISTadtl_",value:function(){for(var i=0,len=this.LIST.length;i<len;i++)"adtl"==this.LIST[i].format&&this.LIST.splice(i)}},{key:"setLabl_",value:function(dwName,label){var adtlIndex=this.getAdtlChunk_();null===adtlIndex&&(this.LIST.push({chunkId:"LIST",chunkSize:4,format:"adtl",subChunks:[]}),adtlIndex=this.LIST.length-1),this.setLabelText_(null===adtlIndex?0:adtlIndex,dwName,label)}},{key:"setLabelText_",value:function(adtlIndex,dwName,label){this.LIST[adtlIndex].subChunks.push({chunkId:"labl",chunkSize:label.length,dwName:dwName,value:label}),this.LIST[adtlIndex].chunkSize+=label.length+4+4+4+1}},{key:"getAdtlChunk_",value:function(){for(var i=0,len=this.LIST.length;i<len;i++)if("adtl"==this.LIST[i].format)return i;return null}},{key:"getLISTINFOIndex_",value:function(){for(var index=null,i=0,len=this.LIST.length;i<len;i++)if("INFO"===this.LIST[i].format){index=i;break}return index}},{key:"getTagIndex_",value:function(tag){for(var index={LIST:null,TAG:null},i=0,len=this.LIST.length;i<len;i++)if("INFO"==this.LIST[i].format){index.LIST=i;for(var j=0,subLen=this.LIST[i].subChunks.length;j<subLen;j++)if(this.LIST[i].subChunks[j].chunkId==tag){index.TAG=j;break}break}return index}},{key:"fixTagName_",value:function(tag){if(tag.constructor!==String)throw new Error("Invalid tag name.");if(tag.length<4)for(var i=0,len=4-tag.length;i<len;i++)tag+=" ";return tag}},{key:"clearHeader_",value:function(){this.fmt.cbSize=0,this.fmt.validBitsPerSample=0,this.fact.chunkId="",this.ds64.chunkId=""}},{key:"assure16Bit_",value:function(){this.assureUncompressed_(),"16"!=this.bitDepth&&this.toBitDepth("16")}},{key:"assureUncompressed_",value:function(){"8a"==this.bitDepth?this.fromALaw():"8m"==this.bitDepth?this.fromMuLaw():"4"==this.bitDepth&&this.fromIMAADPCM()}},{key:"interleave_",value:function(samples){if(samples.length>0&&samples[0].constructor===Array){for(var finalSamples=[],i=0,len=samples[0].length;i<len;i++)for(var j=0,subLen=samples.length;j<subLen;j++)finalSamples.push(samples[j][i]);samples=finalSamples}return samples}},{key:"updateDataType_",value:function(){this.dataType={bits:1+(parseInt(this.bitDepth,10)-1|7),float:"32f"==this.bitDepth||"64"==this.bitDepth,signed:"8"!=this.bitDepth,be:"RIFX"==this.container},["4","8a","8m"].indexOf(this.bitDepth)>-1&&(this.dataType.bits=8,this.dataType.signed=!1)}},{key:"correctContainer_",value:function(){return"RF64"==this.container?"RIFF":this.container}},{key:"truncateSamples_",value:function(samples){for(var i=0,len=samples.length;i<len;i++)samples[i]>1?samples[i]=1:samples[i]<-1&&(samples[i]=-1)}}]),WaveFile}()});
