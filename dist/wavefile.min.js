var WaveFile=function(){"use strict";const t=new Float32Array(1);function e(t,e,h,u){r(e),r(h);let o=function(t,e){let r=function(t){return t};t!=e&&(r=["32f","64"].includes(t)?["32f","64"].includes(e)?a:i:["32f","64"].includes(e)?s:n);return r}(e,h),l={oldMin:Math.pow(2,parseInt(e,10))/2,newMin:Math.pow(2,parseInt(h,10))/2,oldMax:Math.pow(2,parseInt(e,10))/2-1,newMax:Math.pow(2,parseInt(h,10))/2-1};const c=t.length;if("8"==e)for(let e=0;e<c;e++)u[e]=t[e]-=128;for(let e=0;e<c;e++)u[e]=o(t[e],l);if("8"==h)for(let t=0;t<c;t++)u[t]=u[t]+=128}function n(t,e){return t=t>0?parseInt(t/e.oldMax*e.newMax,10):parseInt(t/e.oldMin*e.newMin,10)}function i(t,e){return parseInt(t>0?t*e.newMax:t*e.newMin,10)}function s(t,e){return t>0?t/e.oldMax:t/e.oldMin}function a(e){return t[0]=e,t[0]}function r(t){if("32f"!=t&&"64"!=t&&(parseInt(t,10)<"8"||parseInt(t,10)>"53"))throw new Error("Invalid bit depth.")}const h=[-1,-1,-1,-1,2,4,6,8,-1,-1,-1,-1,2,4,6,8],u=[7,8,9,10,11,12,13,14,16,17,19,21,23,25,28,31,34,37,41,45,50,55,60,66,73,80,88,97,107,118,130,143,157,173,190,209,230,253,279,307,337,371,408,449,494,544,598,658,724,796,876,963,1060,1166,1282,1411,1552,1707,1878,2066,2272,2499,2749,3024,3327,3660,4026,4428,4871,5358,5894,6484,7132,7845,8630,9493,10442,11487,12635,13899,15289,16818,18500,20350,22385,24623,27086,29794,32767];let o=0,l=0,c=0,d=0,f=7;function m(t){let e=function(t){k(t);let e=[];return e.push(255&t),e.push(t>>8&255),e.push(l),e.push(0),e}(t[0]);for(let n=3;n<t.length;n+=2){let i=k(t[n]),s=k(t[n+1]);e.push(s<<4|i)}for(;e.length<256;)e.push(0);return e}function p(t){c=b(t[1]<<8|t[0]),d=t[2],f=u[d];let e=[c,b(t[3]<<8|t[2])];for(let n=4;n<t.length;n++){let i=t[n],s=i>>4,a=s<<4^i;e.push(S(a)),e.push(S(s))}return e}function b(t){return t>32768?t-65536:t}function k(t){let e=t-o,n=0;e>=0?n=0:(n=8,e=-e);let i=u[l],s=i>>3;return e>i&&(n|=4,e-=i,s+=i),e>(i>>=1)&&(n|=2,e-=i,s+=i),e>(i>>=1)&&(n|=1,s+=i),function(t,e){8&t?o-=e:o+=e;o<-32768?o=-32768:o>32767&&(o=32767);(l+=h[7&t])<0?l=0:l>88&&(l=88)}(n,s),n}function S(t){let e=0;return 4&t&&(e+=f),2&t&&(e+=f>>1),1&t&&(e+=f>>2),e+=f>>3,8&t&&(e=-e),(c+=e)>32767?c=32767:c<-32767&&(c=-32767),function(t){(d+=h[t])<0?d=0:d>88&&(d=88);f=u[d]}(t),c}const g=[1,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7];function w(t){let e,n=~(t=-32768==t?-32767:t)>>8&128;if(n||(t*=-1),t>32635&&(t=32635),t>=256){let n=g[t>>8&127];e=n<<4|t>>n+3&15}else e=t>>4;return 85^e^n}function I(t){let e=0;128&(t^=85)&&(t&=-129,e=-1);let n=4+((240&t)>>4),i=0;return i=4!=n?1<<n|(15&t)<<n-4|1<<n-5:t<<1|1,8*(i=0===e?i:-i)*-1}const _=132,C=32635,T=[0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7],L=[0,132,396,924,1980,4092,8316,16764];function x(t){let e,n,i,s;return 0!=(e=t>>8&128)&&(t=-t),t>C&&(t=C),s=~(e|(n=T[(t+=_)>>7&255])<<4|(i=t>>n+3&15))}function z(t){let e,n,i,s;return e=128&(t=~t),i=15&t,s=L[n=t>>4&7]+(i<<n+3),0!=e&&(s=-s),s}const y="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",P=new Uint8Array(256);for(let t=0;t<y.length;t++)P[y.charCodeAt(t)]=t;const M=function(t,e,n){const i=new Uint8Array(t,e,n),s=i.length;let a="";for(let t=0;t<s;t+=3)a+=y[i[t]>>2],a+=y[(3&i[t])<<4|i[t+1]>>4],a+=y[(15&i[t+1])<<2|i[t+2]>>6],a+=y[63&i[t+2]];return s%3==2?a=a.substring(0,a.length-1)+"=":s%3==1&&(a=a.substring(0,a.length-2)+"=="),a},D=function(t){const e=t.length;let n,i,s,a,r=.75*t.length,h=0;"="===t[t.length-1]&&(r--,"="===t[t.length-2]&&r--);const u=new ArrayBuffer(r),o=new Uint8Array(u);for(let r=0;r<e;r+=4)n=P[t.charCodeAt(r)],i=P[t.charCodeAt(r+1)],s=P[t.charCodeAt(r+2)],a=P[t.charCodeAt(r+3)],o[h++]=n<<2|i>>4,o[h++]=(15&i)<<4|s>>2,o[h++]=(3&s)<<6|63&a;return u};function A(t,e,n){e--;for(let i=0;i<e;i++){let s=t[n+i];t[n+i]=t[n+e],t[n+e]=s,e--}}function v(t,e,n=0){for(let i=0,s=t.length;i<s;i++){let s=t.codePointAt(i);if(s<128)e[n]=s,n++;else{let t=0,a=0;for(s<=2047?(t=1,a=192):s<=65535?(t=2,a=224):s<=1114111&&(t=3,a=240,i++),e[n]=(s>>6*t)+a,n++;t>0;)e[n]=128|s>>6*(t-1)&63,n++,t--}}return n}const F="Unsupported type";function R(t){B(t),t==t&&t!==1/0&&t!==-1/0||E("integer")}function B(t){null==t&&E(),t.constructor!=Number&&t.constructor!=Boolean&&E()}function E(t="valid number"){throw new Error("Argument is not a "+t)}class N{constructor(t,e){this.ebits=t,this.fbits=e,this.bias=(1<<t-1)-1,this.numBytes=Math.ceil((t+e)/8),this.biasP2=Math.pow(2,this.bias+1),this.ebitsFbits=t+e,this.fbias=Math.pow(2,-(8*this.numBytes-1-t))}pack(t,e,n){Math.abs(e)>this.biasP2-2*this.ebitsFbits&&(e=e<0?-1/0:1/0);let i=((e=+e)||1/e)<0?1:e<0?1:0;e=Math.abs(e);let s=Math.min(Math.floor(Math.log(e)/Math.LN2),1023),a=this.roundToEven(e/Math.pow(2,s)*Math.pow(2,this.fbits));return e!=e?(a=Math.pow(2,this.fbits-1),s=(1<<this.ebits)-1):0!==e&&(e>=Math.pow(2,1-this.bias)?(a/Math.pow(2,this.fbits)>=2&&(s+=1,a=1),s>this.bias?(s=(1<<this.ebits)-1,a=0):(s+=this.bias,a=this.roundToEven(a)-Math.pow(2,this.fbits))):(a=this.roundToEven(e/Math.pow(2,1-this.bias-this.fbits)),s=0)),this.packFloatBits_(t,n,i,s,a)}unpack(t,e){let n,i=(1<<this.ebits)-1,s="";for(let n=this.numBytes-1;n>=0;n--){let i=t[n+e].toString(2);s+="00000000".substring(i.length)+i}let a="1"==s.charAt(0)?-1:1;s=s.substring(1);let r=parseInt(s.substring(0,this.ebits),2);return s=s.substring(this.ebits),r==i?0!==parseInt(s,2)?NaN:a*(1/0):(0===r?(r+=1,n=parseInt(s,2)):n=parseInt("1"+s,2),a*n*this.fbias*Math.pow(2,r-this.bias))}packFloatBits_(t,e,n,i,s){let a=[];a.push(n);for(let t=this.ebits;t>0;t-=1)a[t]=i%2?1:0,i=Math.floor(i/2);let r=a.length;for(let t=this.fbits;t>0;t-=1)a[r+t]=s%2?1:0,s=Math.floor(s/2);let h=a.join(""),u=this.numBytes+e-1,o=e;for(;u>=e;)t[u]=parseInt(h.substring(0,8),2),h=h.substring(8),u--,o++;return o}roundToEven(t){var e=Math.floor(t),n=t-e;return n<.5?e:n>.5?e+1:e%2?e+1:e}}class U{constructor(t){this.bits=t,this.bytes=t<8?1:Math.ceil(t/8),this.max=Math.pow(2,t)-1,this.min=0;let e=8-(1+(t-1|7)-t);this.lastByteMask_=Math.pow(2,e>0?e:8)-1}pack(t,e,n=0){if(e!=e)throw new Error("NaN");this.overflow(e),t[n]=255&(e<0?e+Math.pow(2,this.bits):e),n++;let i=this.bytes;for(let s=2;s<i;s++)t[n]=255&Math.floor(e/Math.pow(2,8*(s-1))),n++;return this.bits>8&&(t[n]=Math.floor(e/Math.pow(2,8*(this.bytes-1)))&this.lastByteMask_,n++),n}unpack(t,e=0){let n=this.unpackUnsafe(t,e);return this.overflow(n),n}unpackUnsafe(t,e){let n=0;for(let i=0;i<this.bytes;i++)n+=t[e+i]*Math.pow(256,i);return n}overflow(t){if(t>this.max||t<this.min)throw new Error("Overflow")}}class O extends U{constructor(t){super(t),this.max=Math.pow(2,this.bits)/2-1,this.min=-this.max-1}pack(t,e,n=0){return super.pack(t,e,n)}unpack(t,e=0){let n=super.unpackUnsafe(t,e);return n=this.sign_(n),this.overflow(n),n}sign_(t){return t>this.max&&(t-=2*this.max+2),t}}class H{constructor(t,e,n){this.parser=null,e?(!function(t){if(!t||16!==t&&32!==t&&64!==t)throw new Error(F+": float, bits: "+t)}(t),this.parser=this.getFPParser_(t)):(!function(t){if(!t||t<1||t>53)throw new Error(F+": int, bits: "+t)}(t),this.parser=n?new O(t):new U(t),this.parser.bytes=8===this.parser.bytes?4:this.parser.bytes)}unpack(t,e=0){return this.parser.unpack(t,e)}pack(t,e,n=0){return this.parser.pack(t,e,n)}getFPParser_(t){return 16===t?new N(5,11):32===t?new N(8,23):new N(11,52)}}function j(t,e=0,n=t.length){return function(t,e=0,n=t.length){let i="";for(let s=e;s<n;){let e=128,n=191,a=!1,r=t[s++];if(r>=0&&r<=127)i+=String.fromCharCode(r);else{let h=0;r>=194&&r<=223?h=1:r>=224&&r<=239?(h=2,224===t[s]&&(e=160),237===t[s]&&(n=159)):r>=240&&r<=244?(h=3,240===t[s]&&(e=144),244===t[s]&&(n=143)):a=!0,r&=(1<<8-h-1)-1;for(let i=0;i<h;i++)(t[s]<e||t[s]>n)&&(a=!0),r=r<<6|63&t[s],s++;a?i+=String.fromCharCode(65533):r<=65535?i+=String.fromCharCode(r):(r-=65536,i+=String.fromCharCode(55296+(r>>10&1023),56320+(1023&r)))}}return i}(t,e,n)}function G(t){let e=[];return v(t,e,0),e}function X(t,e,n=0){return v(t,e,n)}function V(t,e){let n=[];return W(t,e,n),n}function W(t,e,n,i=0){return Z([t],e,n,i)}function Z(t,e,n,i=0){let s=new H((e=e||{}).bits,e.fp,e.signed),a=Y(e.bits),r=e.fp?B:R,h=0;try{for(let u=t.length;h<u;h++){r(t[h]);let u=i+a;for(;i<u;)i=s.pack(n,t[h],i);Q(e.be,n,a,i-a,i)}}catch(t){throw new Error(t.message+" at input index "+h)}return i}function q(t,e,n=0){return J(t,e,n,n+Y(e.bits),!0)[0]}function J(t,e,n=0,i=t.length,s=!1){let a=[];return K(t,e,a,n,i,s),a}function K(t,e,n,i=0,s=t.length,a=!1){let r=new H((e=e||{}).bits,e.fp,e.signed),h=Y(e.bits),u=(s-i)%h;if(a&&(u||t.length<h))throw new Error("Bad buffer length");s-=u;let o=0;try{Q(e.be,t,h,i,s);for(let e=i;e<s;e+=h,o++)n[o]=r.unpack(t,e);Q(e.be,t,h,i,s)}catch(t){throw new Error(t.message+" at output index "+o)}}function Q(t,e,n,i,s){t&&function(t,e,n=0,i=t.length){if(i%e)throw new Error("Bad buffer length.");for(let s=n;s<i;s+=e)A(t,e,s)}(e,n,i,s)}function Y(t){return t<8?1:Math.ceil(t/8)}var $={4:17,8:1,"8a":6,"8m":7,16:1,24:1,32:1,"32f":3,64:3};function tt(t,e,n,i,s,a){let r={};return r="4"==t?function(t,e,n,i,s,a){let r=et(t,e,n,i,s,a);return r.chunkSize=40+s,r.fmt.chunkSize=20,r.fmt.byteRate=4055,r.fmt.blockAlign=256,r.fmt.bitsPerSample=4,r.fmt.cbSize=2,r.fmt.validBitsPerSample=505,r.fact={chunkId:"fact",chunkSize:4,dwSampleLength:2*s},r}(t,e,n,i,s,a):"8a"==t||"8m"==t?function(t,e,n,i,s,a){let r=et(t,e,n,i,s,a);return r.chunkSize=40+s,r.fmt.chunkSize=20,r.fmt.cbSize=2,r.fmt.validBitsPerSample=8,r.fact={chunkId:"fact",chunkSize:4,dwSampleLength:s},r}(t,e,n,i,s,a):-1==Object.keys($).indexOf(t)||e>2?function(t,e,n,i,s,a){let r=et(t,e,n,i,s,a);return r.chunkSize=60+s,r.fmt.chunkSize=40,r.fmt.bitsPerSample=1+(parseInt(t,10)-1|7),r.fmt.cbSize=22,r.fmt.validBitsPerSample=parseInt(t,10),r.fmt.dwChannelMask=function(t){let e=0;return 1===t?e=4:2===t?e=3:4===t?e=51:6===t?e=63:8===t&&(e=1599),e}(e),r.fmt.subformat=[1,1048576,2852126848,1905997824],r}(t,e,n,i,s,a):et(t,e,n,i,s,a)}function et(t,e,n,i,s,a){return{container:a.container,chunkSize:36+s,format:"WAVE",bitDepth:t,fmt:{chunkId:"fmt ",chunkSize:16,audioFormat:$[t]||65534,numChannels:e,sampleRate:n,byteRate:e*i*n,blockAlign:e*i,bitsPerSample:parseInt(t,10),cbSize:0,validBitsPerSample:0,dwChannelMask:0,subformat:[]}}}function nt(t){!function(t){if(!$[t.bitDepth]){if(parseInt(t.bitDepth,10)>8&&parseInt(t.bitDepth,10)<54)return!0;throw new Error("Invalid bit depth.")}}(t),function(t){let e=t.fmt.numChannels*t.fmt.bitsPerSample/8;if(t.fmt.numChannels<1||e>65535)throw new Error("Invalid number of channels.")}(t),function(t){let e=t.fmt.numChannels*(t.fmt.bitsPerSample/8)*t.fmt.sampleRate;if(t.fmt.sampleRate<1||e>4294967295)throw new Error("Invalid sample rate.")}(t)}class it{constructor(){this.head_=0}writeString_(t,e,n=!0){let i=G(t);if(n)for(let t=i.length;t<e;t++)i.push(0);return i}readZSTR_(t,e=0){let n="";for(let i=e;i<t.length&&(this.head_++,0!==t[i]);i++)n+=j(t,i,i+1);return n}readString_(t,e){let n="";return n=j(t,this.head_,this.head_+e),this.head_+=e,n}read_(t,e){let n=e.bits/8,i=q(t,e,this.head_);return this.head_+=n,i}}let st=new it;function at(t){let e={bits:32,be:!1},n={bits:16,be:!1};n.be="RIFX"===t.container,e.be=n.be;let i=[function(t,e){let n=[];if(t.junk.chunkId)return n.concat(G(t.junk.chunkId),V(t.junk.chunkData.length,e),t.junk.chunkData);return n}(t,e),function(t,e){let n=[];t.ds64.chunkId&&(n=n.concat(G(t.ds64.chunkId),V(t.ds64.chunkSize,e),V(t.ds64.riffSizeHigh,e),V(t.ds64.riffSizeLow,e),V(t.ds64.dataSizeHigh,e),V(t.ds64.dataSizeLow,e),V(t.ds64.originationTime,e),V(t.ds64.sampleCountHigh,e),V(t.ds64.sampleCountLow,e)));return n}(t,e),function(t,e,n){let i=[];(function(t){for(var e in t.bext)if(t.bext.hasOwnProperty(e)&&t.bext[e]&&"timeReference"!=e){t.bext.chunkId="bext";break}(t.bext.timeReference[0]||t.bext.timeReference[1])&&(t.bext.chunkId="bext")})(t),t.bext.chunkId&&(t.bext.chunkSize=602+t.bext.codingHistory.length,i=i.concat(G(t.bext.chunkId),V(602+t.bext.codingHistory.length,e),st.writeString_(t.bext.description,256),st.writeString_(t.bext.originator,32),st.writeString_(t.bext.originatorReference,32),st.writeString_(t.bext.originationDate,10),st.writeString_(t.bext.originationTime,8),V(t.bext.timeReference[0],e),V(t.bext.timeReference[1],e),V(t.bext.version,n),st.writeString_(t.bext.UMID,64),V(t.bext.loudnessValue,n),V(t.bext.loudnessRange,n),V(t.bext.maxTruePeakLevel,n),V(t.bext.maxMomentaryLoudness,n),V(t.bext.maxShortTermLoudness,n),st.writeString_(t.bext.reserved,180),st.writeString_(t.bext.codingHistory,t.bext.codingHistory.length)));return i}(t,e,n),function(t,e,n){let i=[];if(t.fmt.chunkId)return i.concat(G(t.fmt.chunkId),V(t.fmt.chunkSize,e),V(t.fmt.audioFormat,n),V(t.fmt.numChannels,n),V(t.fmt.sampleRate,e),V(t.fmt.byteRate,e),V(t.fmt.blockAlign,n),V(t.fmt.bitsPerSample,n),function(t,e,n){let i=[];t.fmt.chunkSize>16&&(i=i.concat(V(t.fmt.cbSize,n)));t.fmt.chunkSize>18&&(i=i.concat(V(t.fmt.validBitsPerSample,n)));t.fmt.chunkSize>20&&(i=i.concat(V(t.fmt.dwChannelMask,e)));t.fmt.chunkSize>24&&(i=i.concat(V(t.fmt.subformat[0],e),V(t.fmt.subformat[1],e),V(t.fmt.subformat[2],e),V(t.fmt.subformat[3],e)));return i}(t,e,n));throw Error('Could not find the "fmt " chunk')}(t,e,n),function(t,e){let n=[];t.fact.chunkId&&(n=n.concat(G(t.fact.chunkId),V(t.fact.chunkSize,e),V(t.fact.dwSampleLength,e)));return n}(t,e),G(t.data.chunkId),V(t.data.samples.length,e),t.data.samples,function(t,e){let n=[];if(t.cue.chunkId){let i=function(t,e){let n=[];for(let i=0;i<t.cue.dwCuePoints;i++)n=n.concat(V(t.cue.points[i].dwName,e),V(t.cue.points[i].dwPosition,e),G(t.cue.points[i].fccChunk),V(t.cue.points[i].dwChunkStart,e),V(t.cue.points[i].dwBlockStart,e),V(t.cue.points[i].dwSampleOffset,e));return n}(t,e);n=n.concat(G(t.cue.chunkId),V(i.length+4,e),V(t.cue.dwCuePoints,e),i)}return n}(t,e),function(t,e){let n=[];if(t.smpl.chunkId){let i=function(t,e){let n=[];for(let i=0;i<t.smpl.dwNumSampleLoops;i++)n=n.concat(V(t.smpl.loops[i].dwName,e),V(t.smpl.loops[i].dwType,e),V(t.smpl.loops[i].dwStart,e),V(t.smpl.loops[i].dwEnd,e),V(t.smpl.loops[i].dwFraction,e),V(t.smpl.loops[i].dwPlayCount,e));return n}(t,e);n=n.concat(G(t.smpl.chunkId),V(i.length+36,e),V(t.smpl.dwManufacturer,e),V(t.smpl.dwProduct,e),V(t.smpl.dwSamplePeriod,e),V(t.smpl.dwMIDIUnityNote,e),V(t.smpl.dwMIDIPitchFraction,e),V(t.smpl.dwSMPTEFormat,e),V(t.smpl.dwSMPTEOffset,e),V(t.smpl.dwNumSampleLoops,e),V(t.smpl.dwSamplerData,e),i)}return n}(t,e),function(t,e,n){let i=[];for(let s=0;s<t.LIST.length;s++){let a=rt(t.LIST[s].subChunks,t.LIST[s].format,t,e,n);i=i.concat(G(t.LIST[s].chunkId),V(a.length+4,e),G(t.LIST[s].format),a)}return i}(t,e,n)],s=0;for(let t=0;t<i.length;t++)s+=i[t].length;let a=new Uint8Array(s+12),r=0;r=W(s+4,e,a,r=X(t.container,a,r)),r=X(t.format,a,r);for(let t=0;t<i.length;t++)a.set(i[t],r),r+=i[t].length;return a}function rt(t,e,n,i,s){let a=[];for(let r=0;r<t.length;r++)"INFO"==e?(a=a.concat(G(t[r].chunkId),V(t[r].value.length+1,i),st.writeString_(t[r].value,t[r].value.length))).push(0):"adtl"==e&&(["labl","note"].indexOf(t[r].chunkId)>-1?(a=a.concat(G(t[r].chunkId),V(t[r].value.length+4+1,i),V(t[r].dwName,i),st.writeString_(t[r].value,t[r].value.length))).push(0):"ltxt"==t[r].chunkId&&(a=a.concat(ht(t[r],n,i,s)))),a.length%2&&a.push(0);return a}function ht(t,e,n,i){return[].concat(G(t.chunkId),V(t.value.length+20,n),V(t.dwName,n),V(t.dwSampleLength,n),V(t.dwPurposeID,n),V(t.dwCountry,i),V(t.dwLanguage,i),V(t.dwDialect,i),V(t.dwCodePage,i),st.writeString_(t.value,t.value.length))}const ut={bits:32};let ot=0;function lt(t){ot=0;let e=mt(t,0);ut.be="RIFX"==e;let n=j(t,8,12);return ot+=4,{chunkId:e,chunkSize:pt(t,0),format:n,subChunks:dt(t)}}function ct(t,e,n=!1){let i=[];for(let s=0;s<t.length;s++)if(t[s].chunkId==e){if(!n)return t[s];i.push(t[s])}return"LIST"==e&&i.length?i:null}function dt(t){let e=[],n=ot;for(;n<=t.length-8;)e.push(ft(t,n)),n=(n+=8+e[e.length-1].chunkSize)%2?n+1:n;return e}function ft(t,e){let n={chunkId:mt(t,e),chunkSize:pt(t,e)};if("LIST"==n.chunkId)n.format=j(t,e+8,e+12),ot+=4,n.subChunks=dt(t);else{let t=n.chunkSize%2?n.chunkSize+1:n.chunkSize;ot=e+8+t,n.chunkData={start:e+8,end:ot}}return n}function mt(t,e){return ot+=4,j(t,e,e+4)}function pt(t,e){return ot+=4,q(t,ut,e+4)}let bt=new it;function kt(t,e,n){bt.head_=0;let i={bits:32,be:!1},s={bits:16,be:!1};!function(t,e,n,i){if(bt.head_=0,e.container=bt.readString_(t,4),-1===["RIFF","RIFX","RF64"].indexOf(e.container))throw Error("Not a supported format.");if(i.be="RIFX"===e.container,n.be=i.be,e.chunkSize=bt.read_(t,n),e.format=bt.readString_(t,4),"WAVE"!=e.format)throw Error('Could not find the "WAVE" format identifier')}(t,n,i,s);let a=lt(t);!function(t,e,n,i){let s=ct(e,"ds64");if(s)bt.head_=s.chunkData.start,n.ds64.chunkId=s.chunkId,n.ds64.chunkSize=s.chunkSize,n.ds64.riffSizeHigh=bt.read_(t,i),n.ds64.riffSizeLow=bt.read_(t,i),n.ds64.dataSizeHigh=bt.read_(t,i),n.ds64.dataSizeLow=bt.read_(t,i),n.ds64.originationTime=bt.read_(t,i),n.ds64.sampleCountHigh=bt.read_(t,i),n.ds64.sampleCountLow=bt.read_(t,i);else if("RF64"==n.container)throw Error('Could not find the "ds64" chunk')}(t,a.subChunks,n,i),function(t,e,n,i,s){let a=ct(e,"fmt ");if(!a)throw Error('Could not find the "fmt " chunk');bt.head_=a.chunkData.start,n.fmt.chunkId=a.chunkId,n.fmt.chunkSize=a.chunkSize,n.fmt.audioFormat=bt.read_(t,s),n.fmt.numChannels=bt.read_(t,s),n.fmt.sampleRate=bt.read_(t,i),n.fmt.byteRate=bt.read_(t,i),n.fmt.blockAlign=bt.read_(t,s),n.fmt.bitsPerSample=bt.read_(t,s),function(t,e,n,i){e.fmt.chunkSize>16&&(e.fmt.cbSize=bt.read_(t,i),e.fmt.chunkSize>18&&(e.fmt.validBitsPerSample=bt.read_(t,i),e.fmt.chunkSize>20&&(e.fmt.dwChannelMask=bt.read_(t,n),e.fmt.subformat=[bt.read_(t,n),bt.read_(t,n),bt.read_(t,n),bt.read_(t,n)])))}(t,n,i,s)}(t,a.subChunks,n,i,s),function(t,e,n,i){let s=ct(e,"fact");s&&(bt.head_=s.chunkData.start,n.fact.chunkId=s.chunkId,n.fact.chunkSize=s.chunkSize,n.fact.dwSampleLength=bt.read_(t,i))}(t,a.subChunks,n,i),function(t,e,n,i,s){let a=ct(e,"bext");a&&(bt.head_=a.chunkData.start,n.bext.chunkId=a.chunkId,n.bext.chunkSize=a.chunkSize,n.bext.description=bt.readString_(t,256),n.bext.originator=bt.readString_(t,32),n.bext.originatorReference=bt.readString_(t,32),n.bext.originationDate=bt.readString_(t,10),n.bext.originationTime=bt.readString_(t,8),n.bext.timeReference=[bt.read_(t,i),bt.read_(t,i)],n.bext.version=bt.read_(t,s),n.bext.UMID=bt.readString_(t,64),n.bext.loudnessValue=bt.read_(t,s),n.bext.loudnessRange=bt.read_(t,s),n.bext.maxTruePeakLevel=bt.read_(t,s),n.bext.maxMomentaryLoudness=bt.read_(t,s),n.bext.maxShortTermLoudness=bt.read_(t,s),n.bext.reserved=bt.readString_(t,180),n.bext.codingHistory=bt.readString_(t,n.bext.chunkSize-602))}(t,a.subChunks,n,i,s),function(t,e,n,i){let s=ct(e,"cue ");if(s){bt.head_=s.chunkData.start,n.cue.chunkId=s.chunkId,n.cue.chunkSize=s.chunkSize,n.cue.dwCuePoints=bt.read_(t,i);for(let e=0;e<n.cue.dwCuePoints;e++)n.cue.points.push({dwName:bt.read_(t,i),dwPosition:bt.read_(t,i),fccChunk:bt.readString_(t,4),dwChunkStart:bt.read_(t,i),dwBlockStart:bt.read_(t,i),dwSampleOffset:bt.read_(t,i)})}}(t,a.subChunks,n,i),function(t,e,n,i){let s=ct(e,"smpl");if(s){bt.head_=s.chunkData.start,n.smpl.chunkId=s.chunkId,n.smpl.chunkSize=s.chunkSize,n.smpl.dwManufacturer=bt.read_(t,i),n.smpl.dwProduct=bt.read_(t,i),n.smpl.dwSamplePeriod=bt.read_(t,i),n.smpl.dwMIDIUnityNote=bt.read_(t,i),n.smpl.dwMIDIPitchFraction=bt.read_(t,i),n.smpl.dwSMPTEFormat=bt.read_(t,i),n.smpl.dwSMPTEOffset=bt.read_(t,i),n.smpl.dwNumSampleLoops=bt.read_(t,i),n.smpl.dwSamplerData=bt.read_(t,i);for(let e=0;e<n.smpl.dwNumSampleLoops;e++)n.smpl.loops.push({dwName:bt.read_(t,i),dwType:bt.read_(t,i),dwStart:bt.read_(t,i),dwEnd:bt.read_(t,i),dwFraction:bt.read_(t,i),dwPlayCount:bt.read_(t,i)})}}(t,a.subChunks,n,i),function(t,e,n,i){let s=ct(e,"data");if(!s)throw Error('Could not find the "data" chunk');i.data.chunkId="data",i.data.chunkSize=s.chunkSize,n&&(i.data.samples=t.slice(s.chunkData.start,s.chunkData.end))}(t,a.subChunks,e,n),function(t,e,n){let i=ct(e,"junk");i&&(n.junk={chunkId:i.chunkId,chunkSize:i.chunkSize,chunkData:[].slice.call(t.slice(i.chunkData.start,i.chunkData.end))})}(t,a.subChunks,n),function(t,e,n,i,s){let a=ct(e,"LIST",!0);if(null===a)return;for(let e=0;e<a.length;e++){let r=a[e];n.LIST.push({chunkId:r.chunkId,chunkSize:r.chunkSize,format:r.format,subChunks:[]});for(let e=0;e<r.subChunks.length;e++)St(r.subChunks[e],r.format,t,n,i,s)}}(t,a.subChunks,n,i,s)}function St(t,e,n,i,s,a){if("adtl"==e){if(["labl","note","ltxt"].indexOf(t.chunkId)>-1){bt.head_=t.chunkData.start;let e={chunkId:t.chunkId,chunkSize:t.chunkSize,dwName:bt.read_(n,s)};"ltxt"==t.chunkId&&(e.dwSampleLength=bt.read_(n,s),e.dwPurposeID=bt.read_(n,s),e.dwCountry=bt.read_(n,a),e.dwLanguage=bt.read_(n,a),e.dwDialect=bt.read_(n,a),e.dwCodePage=bt.read_(n,a)),e.value=bt.readZSTR_(n,bt.head_),i.LIST[i.LIST.length-1].subChunks.push(e)}}else"INFO"==e&&(bt.head_=t.chunkData.start,i.LIST[i.LIST.length-1].subChunks.push({chunkId:t.chunkId,chunkSize:t.chunkSize,value:bt.readZSTR_(n,bt.head_)}))}class gt{constructor(){this.container="",this.chunkSize=0,this.format="",this.fmt={chunkId:"",chunkSize:0,audioFormat:0,numChannels:0,sampleRate:0,byteRate:0,blockAlign:0,bitsPerSample:0,cbSize:0,validBitsPerSample:0,dwChannelMask:0,subformat:[]},this.fact={chunkId:"",chunkSize:0,dwSampleLength:0},this.cue={chunkId:"",chunkSize:0,dwCuePoints:0,points:[]},this.smpl={chunkId:"",chunkSize:0,dwManufacturer:0,dwProduct:0,dwSamplePeriod:0,dwMIDIUnityNote:0,dwMIDIPitchFraction:0,dwSMPTEFormat:0,dwSMPTEOffset:0,dwNumSampleLoops:0,dwSamplerData:0,loops:[]},this.bext={chunkId:"",chunkSize:0,description:"",originator:"",originatorReference:"",originationDate:"",originationTime:"",timeReference:[0,0],version:0,UMID:"",loudnessValue:0,loudnessRange:0,maxTruePeakLevel:0,maxMomentaryLoudness:0,maxShortTermLoudness:0,reserved:"",codingHistory:""},this.ds64={chunkId:"",chunkSize:0,riffSizeHigh:0,riffSizeLow:0,dataSizeHigh:0,dataSizeLow:0,originationTime:0,sampleCountHigh:0,sampleCountLow:0},this.data={chunkId:"",chunkSize:0,samples:new Uint8Array(0)},this.LIST=[],this.junk={chunkId:"",chunkSize:0,chunkData:[]}}}return class extends gt{constructor(t=null){super(),this.bitDepth="0",this.dataType={},t&&this.fromBuffer(t)}getSample(t){if((t*=this.dataType.bits/8)+this.dataType.bits/8>this.data.samples.length)throw new Error("Range error");return q(this.data.samples.slice(t,t+this.dataType.bits/8),this.dataType)}setSample(t,e){if((t*=this.dataType.bits/8)+this.dataType.bits/8>this.data.samples.length)throw new Error("Range error");W(e,this.dataType,this.data.samples,t)}fromScratch(t,e,n,i,s={}){s.container||(s.container="RIFF"),this.container=s.container,this.bitDepth=n,i=this.interleave_(i),this.updateDataType_();let a=this.dataType.bits/8;this.data.samples=new Uint8Array(i.length*a),Z(i,this.dataType,this.data.samples);let r=tt(n,t,e,a,this.data.samples.length,s);this.clearHeader_(),this.chunkSize=r.chunkSize,this.format=r.format,this.fmt=r.fmt,r.fact&&(this.fact=r.fact),this.data.chunkId="data",this.data.chunkSize=this.data.samples.length,nt(this)}fromBuffer(t,e=!0){this.clearHeader_(),kt(t,e,this),this.bitDepthFromFmt_(),this.updateDataType_()}toBuffer(){return nt(this),at(this)}fromBase64(t){this.fromBuffer(new Uint8Array(D(t)))}toBase64(){let t=this.toBuffer();return M(t,0,t.length)}toDataURI(){return"data:audio/wav;base64,"+this.toBase64()}fromDataURI(t){this.fromBase64(t.replace("data:audio/wav;base64,",""))}toRIFF(){this.fromScratch(this.fmt.numChannels,this.fmt.sampleRate,this.bitDepth,J(this.data.samples,this.dataType))}toRIFX(){this.fromScratch(this.fmt.numChannels,this.fmt.sampleRate,this.bitDepth,J(this.data.samples,this.dataType),{container:"RIFX"})}toBitDepth(t,n=!0){let i=t,s=this.bitDepth;n||("32f"!=t&&(i=this.dataType.bits.toString()),s=this.dataType.bits),this.assureUncompressed_();let a=this.data.samples.length/(this.dataType.bits/8),r=new Float64Array(a+1),h=new Float64Array(a+1);K(this.data.samples,this.dataType,r),"32f"!=s&&"64"!=s||this.truncateSamples_(r),e(r,s,i,h),this.fromScratch(this.fmt.numChannels,this.fmt.sampleRate,t,h,{container:this.correctContainer_()})}toIMAADPCM(){if(8e3!==this.fmt.sampleRate)throw new Error("Only 8000 Hz files can be compressed as IMA-ADPCM.");if(1!==this.fmt.numChannels)throw new Error("Only mono files can be compressed as IMA-ADPCM.");{this.assure16Bit_();let t=new Int16Array(this.data.samples.length/2);K(this.data.samples,this.dataType,t),this.fromScratch(this.fmt.numChannels,this.fmt.sampleRate,"4",function(t){let e=new Uint8Array(t.length/2+512),n=[],i=0;for(let s=0;s<t.length;s++)s%505==0&&0!=s&&(e.set(m(n),i),i+=256,n=[]),n.push(t[s]);return e}(t),{container:this.correctContainer_()})}}fromIMAADPCM(t="16"){this.fromScratch(this.fmt.numChannels,this.fmt.sampleRate,"16",function(t,e=256){let n=new Int16Array(2*t.length),i=[],s=0;for(let a=0;a<t.length;a++)a%e==0&&0!=a&&(n.set(p(i),s),s+=2*e,i=[]),i.push(t[a]);return n}(this.data.samples,this.fmt.blockAlign),{container:this.correctContainer_()}),"16"!=t&&this.toBitDepth(t)}toALaw(){this.assure16Bit_();let t=new Int16Array(this.data.samples.length/2);K(this.data.samples,this.dataType,t),this.fromScratch(this.fmt.numChannels,this.fmt.sampleRate,"8a",function(t){let e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=w(t[n]);return e}(t),{container:this.correctContainer_()})}fromALaw(t="16"){this.fromScratch(this.fmt.numChannels,this.fmt.sampleRate,"16",function(t){let e=new Int16Array(t.length);for(let n=0;n<t.length;n++)e[n]=I(t[n]);return e}(this.data.samples),{container:this.correctContainer_()}),"16"!=t&&this.toBitDepth(t)}toMuLaw(){this.assure16Bit_();let t=new Int16Array(this.data.samples.length/2);K(this.data.samples,this.dataType,t),this.fromScratch(this.fmt.numChannels,this.fmt.sampleRate,"8m",function(t){let e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=x(t[n]);return e}(t),{container:this.correctContainer_()})}fromMuLaw(t="16"){this.fromScratch(this.fmt.numChannels,this.fmt.sampleRate,"16",function(t){let e=new Int16Array(t.length);for(let n=0;n<t.length;n++)e[n]=z(t[n]);return e}(this.data.samples),{container:this.correctContainer_()}),"16"!=t&&this.toBitDepth(t)}setTag(t,e){t=this.fixTagName_(t);let n=this.getTagIndex_(t);null!==n.TAG?(this.LIST[n.LIST].subChunks[n.TAG].chunkSize=e.length+1,this.LIST[n.LIST].subChunks[n.TAG].value=e):null!==n.LIST?this.LIST[n.LIST].subChunks.push({chunkId:t,chunkSize:e.length+1,value:e}):(this.LIST.push({chunkId:"LIST",chunkSize:8+e.length+1,format:"INFO",subChunks:[]}),this.LIST[this.LIST.length-1].subChunks.push({chunkId:t,chunkSize:e.length+1,value:e}))}getTag(t){let e=this.getTagIndex_(t);return null!==e.TAG?this.LIST[e.LIST].subChunks[e.TAG].value:null}listTags(){let t=this.getLISTINFOIndex_(),e={};if(null!==t)for(let n=0,i=this.LIST[t].subChunks.length;n<i;n++)e[this.LIST[t].subChunks[n].chunkId]=this.LIST[t].subChunks[n].value;return e}deleteTag(t){let e=this.getTagIndex_(t);return null!==e.TAG&&(this.LIST[e.LIST].subChunks.splice(e.TAG,1),!0)}setCuePoint(t,e=""){this.cue.chunkId="cue ",t=t*this.fmt.sampleRate/1e3;let n=this.getCuePoints_();this.clearLISTadtl_();let i=this.cue.points.length;this.cue.points=[];let s=!1;if(0===i)this.setCuePoint_(t,1,e);else{for(let a=0;a<i;a++)n[a].dwPosition>t&&!s?(this.setCuePoint_(t,a+1,e),this.setCuePoint_(n[a].dwPosition,a+2,n[a].label),s=!0):this.setCuePoint_(n[a].dwPosition,a+1,n[a].label);s||this.setCuePoint_(t,this.cue.points.length+1,e)}this.cue.dwCuePoints=this.cue.points.length}deleteCuePoint(t){this.cue.chunkId="cue ";let e=this.getCuePoints_();this.clearLISTadtl_();let n=this.cue.points.length;this.cue.points=[];for(let i=0;i<n;i++)i+1!==t&&this.setCuePoint_(e[i].dwPosition,i+1,e[i].label);this.cue.dwCuePoints=this.cue.points.length,this.cue.dwCuePoints?this.cue.chunkId="cue ":(this.cue.chunkId="",this.clearLISTadtl_())}listCuePoints(){let t=this.getCuePoints_();for(let e=0,n=t.length;e<n;e++)t[e].milliseconds=t[e].dwPosition/this.fmt.sampleRate*1e3;return t}updateLabel(t,e){let n=this.getAdtlChunk_();if(null!==n)for(let i=0,s=this.LIST[n].subChunks.length;i<s;i++)this.LIST[n].subChunks[i].dwName==t&&(this.LIST[n].subChunks[i].value=e)}bitDepthFromFmt_(){3===this.fmt.audioFormat&&32===this.fmt.bitsPerSample?this.bitDepth="32f":6===this.fmt.audioFormat?this.bitDepth="8a":7===this.fmt.audioFormat?this.bitDepth="8m":this.bitDepth=this.fmt.bitsPerSample.toString()}setCuePoint_(t,e,n){this.cue.points.push({dwName:e,dwPosition:t,fccChunk:"data",dwChunkStart:0,dwBlockStart:0,dwSampleOffset:t}),this.setLabl_(e,n)}getCuePoints_(){let t=[];for(let e=0,n=this.cue.points.length;e<n;e++)t.push({dwPosition:this.cue.points[e].dwPosition,label:this.getLabelForCuePoint_(this.cue.points[e].dwName)});return t}getLabelForCuePoint_(t){let e=this.getAdtlChunk_();if(null!==e)for(let n=0,i=this.LIST[e].subChunks.length;n<i;n++)if(this.LIST[e].subChunks[n].dwName==t)return this.LIST[e].subChunks[n].value;return""}clearLISTadtl_(){for(let t=0,e=this.LIST.length;t<e;t++)"adtl"==this.LIST[t].format&&this.LIST.splice(t)}setLabl_(t,e){let n=this.getAdtlChunk_();null===n&&(this.LIST.push({chunkId:"LIST",chunkSize:4,format:"adtl",subChunks:[]}),n=this.LIST.length-1),this.setLabelText_(null===n?0:n,t,e)}setLabelText_(t,e,n){this.LIST[t].subChunks.push({chunkId:"labl",chunkSize:n.length,dwName:e,value:n}),this.LIST[t].chunkSize+=n.length+4+4+4+1}getAdtlChunk_(){for(let t=0,e=this.LIST.length;t<e;t++)if("adtl"==this.LIST[t].format)return t;return null}getLISTINFOIndex_(){let t=null;for(let e=0,n=this.LIST.length;e<n;e++)if("INFO"===this.LIST[e].format){t=e;break}return t}getTagIndex_(t){let e={LIST:null,TAG:null};for(let n=0,i=this.LIST.length;n<i;n++)if("INFO"==this.LIST[n].format){e.LIST=n;for(let i=0,s=this.LIST[n].subChunks.length;i<s;i++)if(this.LIST[n].subChunks[i].chunkId==t){e.TAG=i;break}break}return e}fixTagName_(t){if(t.constructor!==String)throw new Error("Invalid tag name.");if(t.length<4)for(let e=0,n=4-t.length;e<n;e++)t+=" ";return t}clearHeader_(){this.fmt.cbSize=0,this.fmt.validBitsPerSample=0,this.fact.chunkId="",this.ds64.chunkId=""}assure16Bit_(){this.assureUncompressed_(),"16"!=this.bitDepth&&this.toBitDepth("16")}assureUncompressed_(){"8a"==this.bitDepth?this.fromALaw():"8m"==this.bitDepth?this.fromMuLaw():"4"==this.bitDepth&&this.fromIMAADPCM()}interleave_(t){if(t.length>0&&t[0].constructor===Array){let e=[];for(let n=0,i=t[0].length;n<i;n++)for(let i=0,s=t.length;i<s;i++)e.push(t[i][n]);t=e}return t}updateDataType_(){this.dataType={bits:1+(parseInt(this.bitDepth,10)-1|7),fp:"32f"==this.bitDepth||"64"==this.bitDepth,signed:"8"!=this.bitDepth,be:"RIFX"==this.container},["4","8a","8m"].indexOf(this.bitDepth)>-1&&(this.dataType.bits=8,this.dataType.signed=!1)}correctContainer_(){return"RF64"==this.container?"RIFF":this.container}truncateSamples_(t){for(let e=0,n=t.length;e<n;e++)t[e]>1?t[e]=1:t[e]<-1&&(t[e]=-1)}}}();window.WaveFile=WaveFile;
