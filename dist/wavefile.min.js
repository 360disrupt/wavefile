var WaveFile=function(){"use strict";const t=new Float32Array(1);function e(t,e,h,u){s(e),s(h);let o=function(t,e){let s=function(t){return t};t!=e&&(s=["32f","64"].includes(t)?["32f","64"].includes(e)?a:r:["32f","64"].includes(e)?i:n);return s}(e,h),l={oldMin:Math.pow(2,parseInt(e,10))/2,newMin:Math.pow(2,parseInt(h,10))/2,oldMax:Math.pow(2,parseInt(e,10))/2-1,newMax:Math.pow(2,parseInt(h,10))/2-1};const c=t.length;if("8"==e)for(let e=0;e<c;e++)u[e]=t[e]-=128;for(let e=0;e<c;e++)u[e]=o(t[e],l);if("8"==h)for(let t=0;t<c;t++)u[t]=u[t]+=128}function n(t,e){return t=t>0?parseInt(t/e.oldMax*e.newMax,10):parseInt(t/e.oldMin*e.newMin,10)}function r(t,e){return parseInt(t>0?t*e.newMax:t*e.newMin,10)}function i(t,e){return t>0?t/e.oldMax:t/e.oldMin}function a(e){return t[0]=e,t[0]}function s(t){if("32f"!=t&&"64"!=t&&(parseInt(t,10)<"8"||parseInt(t,10)>"53"))throw new Error("Invalid bit depth.")}const h=[-1,-1,-1,-1,2,4,6,8,-1,-1,-1,-1,2,4,6,8],u=[7,8,9,10,11,12,13,14,16,17,19,21,23,25,28,31,34,37,41,45,50,55,60,66,73,80,88,97,107,118,130,143,157,173,190,209,230,253,279,307,337,371,408,449,494,544,598,658,724,796,876,963,1060,1166,1282,1411,1552,1707,1878,2066,2272,2499,2749,3024,3327,3660,4026,4428,4871,5358,5894,6484,7132,7845,8630,9493,10442,11487,12635,13899,15289,16818,18500,20350,22385,24623,27086,29794,32767];let o=0,l=0,c=0,d=0,f=7;function p(t){let e=function(t){S(t);let e=[];return e.push(255&t),e.push(t>>8&255),e.push(l),e.push(0),e}(t[0]);for(let n=3;n<t.length;n+=2){let r=S(t[n]),i=S(t[n+1]);e.push(i<<4|r)}for(;e.length<256;)e.push(0);return e}function m(t){c=k(t[1]<<8|t[0]),d=t[2],f=u[d];let e=[c,k(t[3]<<8|t[2])];for(let n=4;n<t.length;n++){let r=t[n],i=r>>4,a=i<<4^r;e.push(b(a)),e.push(b(i))}return e}function k(t){return t>32768?t-65536:t}function S(t){let e=t-o,n=0;e>=0?n=0:(n=8,e=-e);let r=u[l],i=r>>3;return e>r&&(n|=4,e-=r,i+=r),e>(r>>=1)&&(n|=2,e-=r,i+=r),e>(r>>=1)&&(n|=1,i+=r),function(t,e){8&t?o-=e:o+=e;o<-32768?o=-32768:o>32767&&(o=32767);(l+=h[7&t])<0?l=0:l>88&&(l=88)}(n,i),n}function b(t){let e=0;return 4&t&&(e+=f),2&t&&(e+=f>>1),1&t&&(e+=f>>2),e+=f>>3,8&t&&(e=-e),(c+=e)>32767?c=32767:c<-32767&&(c=-32767),function(t){(d+=h[t])<0?d=0:d>88&&(d=88);f=u[d]}(t),c}const w=[1,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7];function g(t){let e,n=~(t=-32768==t?-32767:t)>>8&128;if(n||(t*=-1),t>32635&&(t=32635),t>=256){let n=w[t>>8&127];e=n<<4|t>>n+3&15}else e=t>>4;return 85^e^n}function I(t){let e=0;128&(t^=85)&&(t&=-129,e=-1);let n=4+((240&t)>>4),r=0;return r=4!=n?1<<n|(15&t)<<n-4|1<<n-5:t<<1|1,8*(r=0===e?r:-r)*-1}const _=132,C=32635,T=[0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7],y=[0,132,396,924,1980,4092,8316,16764];function L(t){let e,n,r,i;return 0!=(e=t>>8&128)&&(t=-t),t>C&&(t=C),i=~(e|(n=T[(t+=_)>>7&255])<<4|(r=t>>n+3&15))}function x(t){let e,n,r,i;return e=128&(t=~t),r=15&t,i=y[n=t>>4&7]+(r<<n+3),0!=e&&(i=-i),i}const z="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",M=new Uint8Array(256);for(let t=0;t<z.length;t++)M[z.charCodeAt(t)]=t;const P=function(t,e,n){const r=new Uint8Array(t,e,n),i=r.length;let a="";for(let t=0;t<i;t+=3)a+=z[r[t]>>2],a+=z[(3&r[t])<<4|r[t+1]>>4],a+=z[(15&r[t+1])<<2|r[t+2]>>6],a+=z[63&r[t+2]];return i%3==2?a=a.substring(0,a.length-1)+"=":i%3==1&&(a=a.substring(0,a.length-2)+"=="),a},A=function(t){const e=t.length;let n,r,i,a,s=.75*t.length,h=0;"="===t[t.length-1]&&(s--,"="===t[t.length-2]&&s--);const u=new ArrayBuffer(s),o=new Uint8Array(u);for(let s=0;s<e;s+=4)n=M[t.charCodeAt(s)],r=M[t.charCodeAt(s+1)],i=M[t.charCodeAt(s+2)],a=M[t.charCodeAt(s+3)],o[h++]=n<<2|r>>4,o[h++]=(15&r)<<4|i>>2,o[h++]=(3&i)<<6|63&a;return u};function D(t,e,n=0,r=t.length){if(r%e)throw new Error("Bad buffer length.");for(let i=n;i<r;i+=e)F(t,e,i)}function F(t,e,n){e--;for(let r=0;r<e;r++){let i=t[n+r];t[n+r]=t[n+e],t[n+e]=i,e--}}function v(t,e,n=0){for(let r=0,i=t.length;r<i;r++){let i=t.codePointAt(r);if(i<128)e[n]=i,n++;else{let t=0,a=0;for(i<=2047?(t=1,a=192):i<=65535?(t=2,a=224):i<=1114111&&(t=3,a=240,r++),e[n]=(i>>6*t)+a,n++;t>0;)e[n]=128|i>>6*(t-1)&63,n++,t--}}return n}class R{constructor(t){this.bits=t,this.bytes=t<8?1:Math.ceil(t/8),this.max=Math.pow(2,t)-1,this.min=0;let e=8-(1+(t-1|7)-t);this.lastByteMask_=Math.pow(2,e>0?e:8)-1}pack(t,e,n=0){if(e!=e)throw new Error("NaN");this.overflow(e),t[n]=255&(e<0?e+Math.pow(2,this.bits):e),n++;let r=this.bytes;for(let i=2;i<r;i++)t[n]=255&Math.floor(e/Math.pow(2,8*(i-1))),n++;return this.bits>8&&(t[n]=Math.floor(e/Math.pow(2,8*(this.bytes-1)))&this.lastByteMask_,n++),n}unpack(t,e=0){let n=this.unpackUnsafe(t,e);return this.overflow(n),n}unpackUnsafe(t,e){let n=0;for(let r=0;r<this.bytes;r++)n+=t[e+r]*Math.pow(256,r);return n}overflow(t){if(t>this.max||t<this.min)throw new Error("Overflow")}}class N extends R{constructor(t){super(t),this.max=Math.pow(2,this.bits)/2-1,this.min=-this.max-1}pack(t,e,n=0){return super.pack(t,e,n)}unpack(t,e=0){let n=super.unpackUnsafe(t,e);return n=this.sign_(n),this.overflow(n),n}sign_(t){return t>this.max&&(t-=2*this.max+2),t}}class B{constructor(t,e){this.parser=e?new N(t):new R(t)}pack(t,e,n=0){return this.parser.pack(t,e,n)}unpack(t,e=0){return this.parser.unpack(t,e)}}const E="Unsupported type";function U(t){if(void 0===t)throw new Error("Undefined value");if(null!==t&&t.constructor!=Number&&t.constructor!=Boolean)throw new Error("Can't pack "+t.constructor)}function O(t){if(!t)throw new Error(E);t.float?function(t){if(16!=t.bits&&32!=t.bits&&64!=t.bits)throw new Error(E)}(t):function(t){if(t.bits<1||t.bits>53)throw new Error(E)}(t)}function H(t,e,n,r,i){let a=(1<<r-1)-1;Math.abs(n)>Math.pow(2,a+1)-2*(r+i)&&(n=n<0?-1/0:1/0);let s=((n=+n)||1/n)<0?1:n<0?1:0;n=Math.abs(n);let h=Math.min(Math.floor(Math.log(n)/Math.LN2),1023),u=G(n/Math.pow(2,h)*Math.pow(2,i));return n!=n?(u=Math.pow(2,i-1),h=(1<<r)-1):0!==n&&(n>=Math.pow(2,1-a)?(u/Math.pow(2,i)>=2&&(h+=1,u=1),h>a?(h=(1<<r)-1,u=0):(h+=a,u=G(u)-Math.pow(2,i))):(u=G(n/Math.pow(2,1-a-i)),h=0)),function(t,e,n,r,i,a,s){let h=[];h.push(i);for(let t=n;t>0;t-=1)h[t]=a%2?1:0,a=Math.floor(a/2);let u=h.length;for(let t=r;t>0;t-=1)h[u+t]=s%2?1:0,s=Math.floor(s/2);let o=h.join(""),l=Math.floor((n+r+1)/8)+e-1,c=e;for(;l>=e;)t[l]=parseInt(o.substring(0,8),2),o=o.substring(8),l--,c++;return c}(t,e,r,i,s,h,u)}function j(t,e,n,r){let i,a=(1<<n-1)-1,s=Math.ceil((n+r)/8),h=(1<<n)-1,u=Math.pow(2,-(8*s-1-n)),o="";for(let n=s-1;n>=0;n--){let r=t[n+e].toString(2);o+="00000000".substring(r.length)+r}let l="1"==o.charAt(0)?-1:1;o=o.substring(1);let c=parseInt(o.substring(0,n),2);return o=o.substring(n),c==h?0!==parseInt(o,2)?NaN:l*(1/0):(0===c?(c+=1,i=parseInt(o,2)):i=parseInt("1"+o,2),l*i*u*Math.pow(2,c-a))}function G(t){var e=Math.floor(t),n=t-e;return n<.5?e:n>.5?e+1:e%2?e+1:e}class W extends B{constructor(t){O(t),t.signed=!t.float&&t.signed,super(t.bits,t.signed),this.offset=this.parser.bytes,this.parser.bytes=64===this.parser.bits?4:this.parser.bytes,this.setReaderAndWriter_(t)}read16F_(t,e=0){return j(t,e,5,11)}read32F_(t,e=0){return j(t,e,8,23)}read64F_(t,e=0){return j(t,e,11,52)}write16F_(t,e,n=0){return H(t,n,e,5,11)}write32F_(t,e,n=0){return H(t,n,e,8,23)}write64F_(t,e,n=0){return H(t,n,e,11,52)}setReaderAndWriter_(t){t.float?16==t.bits?(this.unpack=this.read16F_,this.pack=this.write16F_):32==t.bits?(this.unpack=this.read32F_,this.pack=this.write32F_):(this.unpack=this.read64F_,this.pack=this.write64F_):(this.unpack=super.unpack,this.pack=super.pack)}}function X(t,e=0,n=null){return function(t,e=0,n=null){n=null!==n?n+1:t.length;let r="";for(let i=e;i<n;){let e=128,n=191,a=!1,s=t[i++];if(s>=0&&s<=127)r+=String.fromCharCode(s);else{let h=0;s>=194&&s<=223?h=1:s>=224&&s<=239?(h=2,224===t[i]&&(e=160),237===t[i]&&(n=159)):s>=240&&s<=244?(h=3,240===t[i]&&(e=144),244===t[i]&&(n=143)):a=!0,s&=(1<<8-h-1)-1;for(let r=0;r<h;r++)(t[i]<e||t[i]>n)&&(a=!0),s=s<<6|63&t[i],i++;a?r+=String.fromCharCode(65533):s<=65535?r+=String.fromCharCode(s):(s-=65536,r+=String.fromCharCode(55296+(s>>10&1023),56320+(1023&s)))}}return r}(t,e,n)}function V(t){let e=new Uint8Array(function(t){let e=0;for(let n=0,r=t.length;n<r;n++){let r=t.codePointAt(n);r<128?e++:(r<=2047?e++:r<=65535?e+=2:r<=1114111&&(n++,e+=3),e++)}return e}(t));return v(t,e,0),e}function Z(t,e,n=0){return v(t,e,n)}function q(t,e){let n=[];return J(t,e,n),n}function J(t,e,n,r=0){return K([t],e,n,r)}function K(t,e,n,r=0){let i=new W(e),a=t.length;for(let s=0;s<a;s++){U(t[s]);let a=r+i.offset;for(;r<a;)r=i.pack(n,t[s],r);e.be&&D(n,i.offset,r-i.offset,r)}return r}function Q(t,e,n=0){let r=new W(e);if(r.offset+n>t.length)throw Error("Bad buffer length");e.be&&D(t,r.offset,n,n+r.offset);let i=r.unpack(t,n);return e.be&&D(t,r.offset,n,n+r.offset),i}function Y(t,e,n=0,r=t.length){let i=[];return $(t,e,i,n,r),i}function $(t,e,n,r=0,i=t.length){let a=new W(e),s=r;for(;(i-r)%a.offset;)i--;e.be&&D(t,a.offset,r,i);for(let e=0;r<i;r+=a.offset)n[e]=a.unpack(t,r),e++;e.be&&D(t,a.offset,s,i)}var tt={4:17,8:1,"8a":6,"8m":7,16:1,24:1,32:1,"32f":3,64:3};function et(t,e,n,r,i,a){let s={};return s="4"==t?function(t,e,n,r,i,a){let s=nt(t,e,n,r,i,a);return s.chunkSize=40+i,s.fmt.chunkSize=20,s.fmt.byteRate=4055,s.fmt.blockAlign=256,s.fmt.bitsPerSample=4,s.fmt.cbSize=2,s.fmt.validBitsPerSample=505,s.fact={chunkId:"fact",chunkSize:4,dwSampleLength:2*i},s}(t,e,n,r,i,a):"8a"==t||"8m"==t?function(t,e,n,r,i,a){let s=nt(t,e,n,r,i,a);return s.chunkSize=40+i,s.fmt.chunkSize=20,s.fmt.cbSize=2,s.fmt.validBitsPerSample=8,s.fact={chunkId:"fact",chunkSize:4,dwSampleLength:i},s}(t,e,n,r,i,a):-1==Object.keys(tt).indexOf(t)||e>2?function(t,e,n,r,i,a){let s=nt(t,e,n,r,i,a);return s.chunkSize=60+i,s.fmt.chunkSize=40,s.fmt.bitsPerSample=1+(parseInt(t,10)-1|7),s.fmt.cbSize=22,s.fmt.validBitsPerSample=parseInt(t,10),s.fmt.dwChannelMask=function(t){let e=0;return 1===t?e=4:2===t?e=3:4===t?e=51:6===t?e=63:8===t&&(e=1599),e}(e),s.fmt.subformat=[1,1048576,2852126848,1905997824],s}(t,e,n,r,i,a):nt(t,e,n,r,i,a)}function nt(t,e,n,r,i,a){return{container:a.container,chunkSize:36+i,format:"WAVE",bitDepth:t,fmt:{chunkId:"fmt ",chunkSize:16,audioFormat:tt[t]||65534,numChannels:e,sampleRate:n,byteRate:e*r*n,blockAlign:e*r,bitsPerSample:parseInt(t,10),cbSize:0,validBitsPerSample:0,dwChannelMask:0,subformat:[]}}}function rt(t){!function(t){if(!tt[t.bitDepth]){if(parseInt(t.bitDepth,10)>8&&parseInt(t.bitDepth,10)<54)return!0;throw new Error("Invalid bit depth.")}}(t),function(t){let e=t.fmt.numChannels*t.fmt.bitsPerSample/8;if(t.fmt.numChannels<1||e>65535)throw new Error("Invalid number of channels.")}(t),function(t){let e=t.fmt.numChannels*(t.fmt.bitsPerSample/8)*t.fmt.sampleRate;if(t.fmt.sampleRate<1||e>4294967295)throw new Error("Invalid sample rate.")}(t)}class it{constructor(){this.head_=0}writeString_(t,e,n=!0){let r=Array.prototype.slice.call(V(t));if(n)for(let t=r.length;t<e;t++)r.push(0);return r}readZSTR_(t,e=0){let n="";for(let r=e;r<t.length&&(this.head_++,0!==t[r]);r++)n+=X(t,r,r);return n}readString_(t,e){let n="";return n=X(t,this.head_,this.head_+e-1),this.head_+=e,n}read_(t,e){let n=e.bits/8,r=Q(t,e,this.head_);return this.head_+=n,r}}let at=new it;function st(t){let e={bits:32,be:!1},n={bits:16,be:!1};n.be="RIFX"===t.container,e.be=n.be;let r=[function(t,e){let n=[];if(t.junk.chunkId)return n.concat(Array.prototype.slice.call(V(t.junk.chunkId)),q(t.junk.chunkData.length,e),t.junk.chunkData);return n}(t,e),function(t,e){let n=[];t.ds64.chunkId&&(n=n.concat(Array.prototype.slice.call(V(t.ds64.chunkId)),q(t.ds64.chunkSize,e),q(t.ds64.riffSizeHigh,e),q(t.ds64.riffSizeLow,e),q(t.ds64.dataSizeHigh,e),q(t.ds64.dataSizeLow,e),q(t.ds64.originationTime,e),q(t.ds64.sampleCountHigh,e),q(t.ds64.sampleCountLow,e)));return n}(t,e),function(t,e,n){let r=[];(function(t){for(var e in t.bext)if(t.bext.hasOwnProperty(e)&&t.bext[e]&&"timeReference"!=e){t.bext.chunkId="bext";break}(t.bext.timeReference[0]||t.bext.timeReference[1])&&(t.bext.chunkId="bext")})(t),t.bext.chunkId&&(t.bext.chunkSize=602+t.bext.codingHistory.length,r=r.concat(Array.prototype.slice.call(V(t.bext.chunkId)),q(602+t.bext.codingHistory.length,e),at.writeString_(t.bext.description,256),at.writeString_(t.bext.originator,32),at.writeString_(t.bext.originatorReference,32),at.writeString_(t.bext.originationDate,10),at.writeString_(t.bext.originationTime,8),q(t.bext.timeReference[0],e),q(t.bext.timeReference[1],e),q(t.bext.version,n),Array.prototype.slice.call(at.writeString_(t.bext.UMID,64)),q(t.bext.loudnessValue,n),q(t.bext.loudnessRange,n),q(t.bext.maxTruePeakLevel,n),q(t.bext.maxMomentaryLoudness,n),q(t.bext.maxShortTermLoudness,n),at.writeString_(t.bext.reserved,180),at.writeString_(t.bext.codingHistory,t.bext.codingHistory.length)));return r}(t,e,n),function(t,e,n){let r=[];if(t.fmt.chunkId)return r.concat(Array.prototype.slice.call(V(t.fmt.chunkId)),q(t.fmt.chunkSize,e),q(t.fmt.audioFormat,n),q(t.fmt.numChannels,n),q(t.fmt.sampleRate,e),q(t.fmt.byteRate,e),q(t.fmt.blockAlign,n),q(t.fmt.bitsPerSample,n),function(t,e,n){let r=[];t.fmt.chunkSize>16&&(r=r.concat(q(t.fmt.cbSize,n)));t.fmt.chunkSize>18&&(r=r.concat(q(t.fmt.validBitsPerSample,n)));t.fmt.chunkSize>20&&(r=r.concat(q(t.fmt.dwChannelMask,e)));t.fmt.chunkSize>24&&(r=r.concat(q(t.fmt.subformat[0],e),q(t.fmt.subformat[1],e),q(t.fmt.subformat[2],e),q(t.fmt.subformat[3],e)));return r}(t,e,n));throw Error('Could not find the "fmt " chunk')}(t,e,n),function(t,e){let n=[];t.fact.chunkId&&(n=n.concat(Array.prototype.slice.call(V(t.fact.chunkId)),q(t.fact.chunkSize,e),q(t.fact.dwSampleLength,e)));return n}(t,e),Array.prototype.slice.call(V(t.data.chunkId)),q(t.data.samples.length,e),t.data.samples,function(t,e){let n=[];if(t.cue.chunkId){let r=function(t,e){let n=[];for(let r=0;r<t.cue.dwCuePoints;r++)n=n.concat(q(t.cue.points[r].dwName,e),q(t.cue.points[r].dwPosition,e),Array.prototype.slice.call(V(t.cue.points[r].fccChunk)),q(t.cue.points[r].dwChunkStart,e),q(t.cue.points[r].dwBlockStart,e),q(t.cue.points[r].dwSampleOffset,e));return n}(t,e);n=n.concat(Array.prototype.slice.call(V(t.cue.chunkId)),q(r.length+4,e),q(t.cue.dwCuePoints,e),r)}return n}(t,e),function(t,e){let n=[];if(t.smpl.chunkId){let r=function(t,e){let n=[];for(let r=0;r<t.smpl.dwNumSampleLoops;r++)n=n.concat(q(t.smpl.loops[r].dwName,e),q(t.smpl.loops[r].dwType,e),q(t.smpl.loops[r].dwStart,e),q(t.smpl.loops[r].dwEnd,e),q(t.smpl.loops[r].dwFraction,e),q(t.smpl.loops[r].dwPlayCount,e));return n}(t,e);n=n.concat(Array.prototype.slice.call(V(t.smpl.chunkId)),q(r.length+36,e),q(t.smpl.dwManufacturer,e),q(t.smpl.dwProduct,e),q(t.smpl.dwSamplePeriod,e),q(t.smpl.dwMIDIUnityNote,e),q(t.smpl.dwMIDIPitchFraction,e),q(t.smpl.dwSMPTEFormat,e),q(t.smpl.dwSMPTEOffset,e),q(t.smpl.dwNumSampleLoops,e),q(t.smpl.dwSamplerData,e),r)}return n}(t,e),function(t,e,n){let r=[];for(let i=0;i<t.LIST.length;i++){let a=ht(t.LIST[i].subChunks,t.LIST[i].format,t,e,n);r=r.concat(Array.prototype.slice.call(V(t.LIST[i].chunkId)),q(a.length+4,e),Array.prototype.slice.call(V(t.LIST[i].format)),a)}return r}(t,e,n)],i=0;for(let t=0;t<r.length;t++)i+=r[t].length;let a=new Uint8Array(i+12),s=0;s=J(i+4,e,a,s=Z(t.container,a,s)),s=Z(t.format,a,s);for(let t=0;t<r.length;t++)a.set(r[t],s),s+=r[t].length;return a}function ht(t,e,n,r,i){let a=[];for(let s=0;s<t.length;s++)"INFO"==e?(a=a.concat(Array.prototype.slice.call(V(t[s].chunkId)),q(t[s].value.length+1,r),at.writeString_(t[s].value,t[s].value.length))).push(0):"adtl"==e&&(["labl","note"].indexOf(t[s].chunkId)>-1?(a=a.concat(Array.prototype.slice.call(V(t[s].chunkId)),q(t[s].value.length+4+1,r),q(t[s].dwName,r),at.writeString_(t[s].value,t[s].value.length))).push(0):"ltxt"==t[s].chunkId&&(a=a.concat(ut(t[s],n,r,i)))),a.length%2&&a.push(0);return a}function ut(t,e,n,r){return[].concat(Array.prototype.slice.call(V(t.chunkId)),q(t.value.length+20,n),q(t.dwName,n),q(t.dwSampleLength,n),q(t.dwPurposeID,n),q(t.dwCountry,r),q(t.dwLanguage,r),q(t.dwDialect,r),q(t.dwCodePage,r),at.writeString_(t.value,t.value.length))}const ot={bits:32};let lt=0;function ct(t){lt=0;let e=mt(t,0);ot.be="RIFX"==e;let n=X(t,8,11);return lt+=4,{chunkId:e,chunkSize:kt(t,0),format:n,subChunks:ft(t)}}function dt(t,e,n=!1){let r=[];for(let i=0;i<t.length;i++)if(t[i].chunkId==e){if(!n)return t[i];r.push(t[i])}return"LIST"==e&&r.length?r:null}function ft(t){let e=[],n=lt;for(;n<=t.length-8;)e.push(pt(t,n)),n=(n+=8+e[e.length-1].chunkSize)%2?n+1:n;return e}function pt(t,e){let n={chunkId:mt(t,e),chunkSize:kt(t,e)};if("LIST"==n.chunkId)n.format=X(t,e+8,e+11),lt+=4,n.subChunks=ft(t);else{let t=n.chunkSize%2?n.chunkSize+1:n.chunkSize;lt=e+8+t,n.chunkData={start:e+8,end:lt}}return n}function mt(t,e){return lt+=4,X(t,e,e+3)}function kt(t,e){return lt+=4,Q(t,ot,e+4)}let St=new it;function bt(t,e,n){St.head_=0;let r={bits:32,be:!1},i={bits:16,be:!1};!function(t,e,n,r){if(St.head_=0,e.container=St.readString_(t,4),-1===["RIFF","RIFX","RF64"].indexOf(e.container))throw Error("Not a supported format.");if(r.be="RIFX"===e.container,n.be=r.be,e.chunkSize=St.read_(t,n),e.format=St.readString_(t,4),"WAVE"!=e.format)throw Error('Could not find the "WAVE" format identifier')}(t,n,r,i);let a=ct(t);!function(t,e,n,r){let i=dt(e,"ds64");if(i)St.head_=i.chunkData.start,n.ds64.chunkId=i.chunkId,n.ds64.chunkSize=i.chunkSize,n.ds64.riffSizeHigh=St.read_(t,r),n.ds64.riffSizeLow=St.read_(t,r),n.ds64.dataSizeHigh=St.read_(t,r),n.ds64.dataSizeLow=St.read_(t,r),n.ds64.originationTime=St.read_(t,r),n.ds64.sampleCountHigh=St.read_(t,r),n.ds64.sampleCountLow=St.read_(t,r);else if("RF64"==n.container)throw Error('Could not find the "ds64" chunk')}(t,a.subChunks,n,r),function(t,e,n,r,i){let a=dt(e,"fmt ");if(!a)throw Error('Could not find the "fmt " chunk');St.head_=a.chunkData.start,n.fmt.chunkId=a.chunkId,n.fmt.chunkSize=a.chunkSize,n.fmt.audioFormat=St.read_(t,i),n.fmt.numChannels=St.read_(t,i),n.fmt.sampleRate=St.read_(t,r),n.fmt.byteRate=St.read_(t,r),n.fmt.blockAlign=St.read_(t,i),n.fmt.bitsPerSample=St.read_(t,i),function(t,e,n,r){e.fmt.chunkSize>16&&(e.fmt.cbSize=St.read_(t,r),e.fmt.chunkSize>18&&(e.fmt.validBitsPerSample=St.read_(t,r),e.fmt.chunkSize>20&&(e.fmt.dwChannelMask=St.read_(t,n),e.fmt.subformat=[St.read_(t,n),St.read_(t,n),St.read_(t,n),St.read_(t,n)])))}(t,n,r,i)}(t,a.subChunks,n,r,i),function(t,e,n,r){let i=dt(e,"fact");i&&(St.head_=i.chunkData.start,n.fact.chunkId=i.chunkId,n.fact.chunkSize=i.chunkSize,n.fact.dwSampleLength=St.read_(t,r))}(t,a.subChunks,n,r),function(t,e,n,r,i){let a=dt(e,"bext");a&&(St.head_=a.chunkData.start,n.bext.chunkId=a.chunkId,n.bext.chunkSize=a.chunkSize,n.bext.description=St.readString_(t,256),n.bext.originator=St.readString_(t,32),n.bext.originatorReference=St.readString_(t,32),n.bext.originationDate=St.readString_(t,10),n.bext.originationTime=St.readString_(t,8),n.bext.timeReference=[St.read_(t,r),St.read_(t,r)],n.bext.version=St.read_(t,i),n.bext.UMID=St.readString_(t,64),n.bext.loudnessValue=St.read_(t,i),n.bext.loudnessRange=St.read_(t,i),n.bext.maxTruePeakLevel=St.read_(t,i),n.bext.maxMomentaryLoudness=St.read_(t,i),n.bext.maxShortTermLoudness=St.read_(t,i),n.bext.reserved=St.readString_(t,180),n.bext.codingHistory=St.readString_(t,n.bext.chunkSize-602))}(t,a.subChunks,n,r,i),function(t,e,n,r){let i=dt(e,"cue ");if(i){St.head_=i.chunkData.start,n.cue.chunkId=i.chunkId,n.cue.chunkSize=i.chunkSize,n.cue.dwCuePoints=St.read_(t,r);for(let e=0;e<n.cue.dwCuePoints;e++)n.cue.points.push({dwName:St.read_(t,r),dwPosition:St.read_(t,r),fccChunk:St.readString_(t,4),dwChunkStart:St.read_(t,r),dwBlockStart:St.read_(t,r),dwSampleOffset:St.read_(t,r)})}}(t,a.subChunks,n,r),function(t,e,n,r){let i=dt(e,"smpl");if(i){St.head_=i.chunkData.start,n.smpl.chunkId=i.chunkId,n.smpl.chunkSize=i.chunkSize,n.smpl.dwManufacturer=St.read_(t,r),n.smpl.dwProduct=St.read_(t,r),n.smpl.dwSamplePeriod=St.read_(t,r),n.smpl.dwMIDIUnityNote=St.read_(t,r),n.smpl.dwMIDIPitchFraction=St.read_(t,r),n.smpl.dwSMPTEFormat=St.read_(t,r),n.smpl.dwSMPTEOffset=St.read_(t,r),n.smpl.dwNumSampleLoops=St.read_(t,r),n.smpl.dwSamplerData=St.read_(t,r);for(let e=0;e<n.smpl.dwNumSampleLoops;e++)n.smpl.loops.push({dwName:St.read_(t,r),dwType:St.read_(t,r),dwStart:St.read_(t,r),dwEnd:St.read_(t,r),dwFraction:St.read_(t,r),dwPlayCount:St.read_(t,r)})}}(t,a.subChunks,n,r),function(t,e,n,r){let i=dt(e,"data");if(!i)throw Error('Could not find the "data" chunk');r.data.chunkId="data",r.data.chunkSize=i.chunkSize,n&&(r.data.samples=t.slice(i.chunkData.start,i.chunkData.end))}(t,a.subChunks,e,n),function(t,e,n){let r=dt(e,"junk");r&&(n.junk={chunkId:r.chunkId,chunkSize:r.chunkSize,chunkData:[].slice.call(t.slice(r.chunkData.start,r.chunkData.end))})}(t,a.subChunks,n),function(t,e,n,r,i){let a=dt(e,"LIST",!0);if(null===a)return;for(let e=0;e<a.length;e++){let s=a[e];n.LIST.push({chunkId:s.chunkId,chunkSize:s.chunkSize,format:s.format,subChunks:[]});for(let e=0;e<s.subChunks.length;e++)wt(s.subChunks[e],s.format,t,n,r,i)}}(t,a.subChunks,n,r,i)}function wt(t,e,n,r,i,a){if("adtl"==e){if(["labl","note","ltxt"].indexOf(t.chunkId)>-1){St.head_=t.chunkData.start;let e={chunkId:t.chunkId,chunkSize:t.chunkSize,dwName:St.read_(n,i)};"ltxt"==t.chunkId&&(e.dwSampleLength=St.read_(n,i),e.dwPurposeID=St.read_(n,i),e.dwCountry=St.read_(n,a),e.dwLanguage=St.read_(n,a),e.dwDialect=St.read_(n,a),e.dwCodePage=St.read_(n,a)),e.value=St.readZSTR_(n,St.head_),r.LIST[r.LIST.length-1].subChunks.push(e)}}else"INFO"==e&&(St.head_=t.chunkData.start,r.LIST[r.LIST.length-1].subChunks.push({chunkId:t.chunkId,chunkSize:t.chunkSize,value:St.readZSTR_(n,St.head_)}))}class gt{constructor(){this.container="",this.chunkSize=0,this.format="",this.fmt={chunkId:"",chunkSize:0,audioFormat:0,numChannels:0,sampleRate:0,byteRate:0,blockAlign:0,bitsPerSample:0,cbSize:0,validBitsPerSample:0,dwChannelMask:0,subformat:[]},this.fact={chunkId:"",chunkSize:0,dwSampleLength:0},this.cue={chunkId:"",chunkSize:0,dwCuePoints:0,points:[]},this.smpl={chunkId:"",chunkSize:0,dwManufacturer:0,dwProduct:0,dwSamplePeriod:0,dwMIDIUnityNote:0,dwMIDIPitchFraction:0,dwSMPTEFormat:0,dwSMPTEOffset:0,dwNumSampleLoops:0,dwSamplerData:0,loops:[]},this.bext={chunkId:"",chunkSize:0,description:"",originator:"",originatorReference:"",originationDate:"",originationTime:"",timeReference:[0,0],version:0,UMID:"",loudnessValue:0,loudnessRange:0,maxTruePeakLevel:0,maxMomentaryLoudness:0,maxShortTermLoudness:0,reserved:"",codingHistory:""},this.ds64={chunkId:"",chunkSize:0,riffSizeHigh:0,riffSizeLow:0,dataSizeHigh:0,dataSizeLow:0,originationTime:0,sampleCountHigh:0,sampleCountLow:0},this.data={chunkId:"",chunkSize:0,samples:new Uint8Array(0)},this.LIST=[],this.junk={chunkId:"",chunkSize:0,chunkData:[]}}}return class extends gt{constructor(t=null){super(),this.bitDepth="0",this.dataType={},t&&this.fromBuffer(t)}getSample(t){if((t*=this.dataType.bits/8)+this.dataType.bits/8>this.data.samples.length)throw new Error("Range error");return Q(this.data.samples.slice(t,t+this.dataType.bits/8),this.dataType)}setSample(t,e){if((t*=this.dataType.bits/8)+this.dataType.bits/8>this.data.samples.length)throw new Error("Range error");J(e,this.dataType,this.data.samples,t)}fromScratch(t,e,n,r,i={}){i.container||(i.container="RIFF"),this.container=i.container,this.bitDepth=n,r=this.interleave_(r),this.updateDataType_();let a=this.dataType.bits/8;this.data.samples=new Uint8Array(r.length*a),K(r,this.dataType,this.data.samples);let s=et(n,t,e,a,this.data.samples.length,i);this.clearHeader_(),this.chunkSize=s.chunkSize,this.format=s.format,this.fmt=s.fmt,s.fact&&(this.fact=s.fact),this.data.chunkId="data",this.data.chunkSize=this.data.samples.length,rt(this)}fromBuffer(t,e=!0){this.clearHeader_(),bt(t,e,this),this.bitDepthFromFmt_(),this.updateDataType_()}toBuffer(){return rt(this),st(this)}fromBase64(t){this.fromBuffer(new Uint8Array(A(t)))}toBase64(){let t=this.toBuffer();return P(t,0,t.length)}toDataURI(){return"data:audio/wav;base64,"+this.toBase64()}fromDataURI(t){this.fromBase64(t.replace("data:audio/wav;base64,",""))}toRIFF(){this.fromScratch(this.fmt.numChannels,this.fmt.sampleRate,this.bitDepth,Y(this.data.samples,this.dataType))}toRIFX(){this.fromScratch(this.fmt.numChannels,this.fmt.sampleRate,this.bitDepth,Y(this.data.samples,this.dataType),{container:"RIFX"})}toBitDepth(t,n=!0){let r=t,i=this.bitDepth;n||("32f"!=t&&(r=this.dataType.bits.toString()),i=this.dataType.bits),this.assureUncompressed_();let a=this.data.samples.length/(this.dataType.bits/8),s=new Float64Array(a+1),h=new Float64Array(a+1);$(this.data.samples,this.dataType,s),"32f"!=i&&"64"!=i||this.truncateSamples_(s),e(s,i,r,h),this.fromScratch(this.fmt.numChannels,this.fmt.sampleRate,t,h,{container:this.correctContainer_()})}toIMAADPCM(){if(8e3!==this.fmt.sampleRate)throw new Error("Only 8000 Hz files can be compressed as IMA-ADPCM.");if(1!==this.fmt.numChannels)throw new Error("Only mono files can be compressed as IMA-ADPCM.");{this.assure16Bit_();let t=new Int16Array(this.data.samples.length/2);$(this.data.samples,this.dataType,t),this.fromScratch(this.fmt.numChannels,this.fmt.sampleRate,"4",function(t){let e=new Uint8Array(t.length/2+512),n=[],r=0;for(let i=0;i<t.length;i++)i%505==0&&0!=i&&(e.set(p(n),r),r+=256,n=[]),n.push(t[i]);return e}(t),{container:this.correctContainer_()})}}fromIMAADPCM(t="16"){this.fromScratch(this.fmt.numChannels,this.fmt.sampleRate,"16",function(t,e=256){let n=new Int16Array(2*t.length),r=[],i=0;for(let a=0;a<t.length;a++)a%e==0&&0!=a&&(n.set(m(r),i),i+=2*e,r=[]),r.push(t[a]);return n}(this.data.samples,this.fmt.blockAlign),{container:this.correctContainer_()}),"16"!=t&&this.toBitDepth(t)}toALaw(){this.assure16Bit_();let t=new Int16Array(this.data.samples.length/2);$(this.data.samples,this.dataType,t),this.fromScratch(this.fmt.numChannels,this.fmt.sampleRate,"8a",function(t){let e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=g(t[n]);return e}(t),{container:this.correctContainer_()})}fromALaw(t="16"){this.fromScratch(this.fmt.numChannels,this.fmt.sampleRate,"16",function(t){let e=new Int16Array(t.length);for(let n=0;n<t.length;n++)e[n]=I(t[n]);return e}(this.data.samples),{container:this.correctContainer_()}),"16"!=t&&this.toBitDepth(t)}toMuLaw(){this.assure16Bit_();let t=new Int16Array(this.data.samples.length/2);$(this.data.samples,this.dataType,t),this.fromScratch(this.fmt.numChannels,this.fmt.sampleRate,"8m",function(t){let e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=L(t[n]);return e}(t),{container:this.correctContainer_()})}fromMuLaw(t="16"){this.fromScratch(this.fmt.numChannels,this.fmt.sampleRate,"16",function(t){let e=new Int16Array(t.length);for(let n=0;n<t.length;n++)e[n]=x(t[n]);return e}(this.data.samples),{container:this.correctContainer_()}),"16"!=t&&this.toBitDepth(t)}setTag(t,e){t=this.fixTagName_(t);let n=this.getTagIndex_(t);null!==n.TAG?(this.LIST[n.LIST].subChunks[n.TAG].chunkSize=e.length+1,this.LIST[n.LIST].subChunks[n.TAG].value=e):null!==n.LIST?this.LIST[n.LIST].subChunks.push({chunkId:t,chunkSize:e.length+1,value:e}):(this.LIST.push({chunkId:"LIST",chunkSize:8+e.length+1,format:"INFO",subChunks:[]}),this.LIST[this.LIST.length-1].subChunks.push({chunkId:t,chunkSize:e.length+1,value:e}))}getTag(t){let e=this.getTagIndex_(t);return null!==e.TAG?this.LIST[e.LIST].subChunks[e.TAG].value:null}listTags(){let t=this.getLISTINFOIndex_(),e={};if(null!==t)for(let n=0,r=this.LIST[t].subChunks.length;n<r;n++)e[this.LIST[t].subChunks[n].chunkId]=this.LIST[t].subChunks[n].value;return e}deleteTag(t){let e=this.getTagIndex_(t);return null!==e.TAG&&(this.LIST[e.LIST].subChunks.splice(e.TAG,1),!0)}setCuePoint(t,e=""){this.cue.chunkId="cue ",t=t*this.fmt.sampleRate/1e3;let n=this.getCuePoints_();this.clearLISTadtl_();let r=this.cue.points.length;this.cue.points=[];let i=!1;if(0===r)this.setCuePoint_(t,1,e);else{for(let a=0;a<r;a++)n[a].dwPosition>t&&!i?(this.setCuePoint_(t,a+1,e),this.setCuePoint_(n[a].dwPosition,a+2,n[a].label),i=!0):this.setCuePoint_(n[a].dwPosition,a+1,n[a].label);i||this.setCuePoint_(t,this.cue.points.length+1,e)}this.cue.dwCuePoints=this.cue.points.length}deleteCuePoint(t){this.cue.chunkId="cue ";let e=this.getCuePoints_();this.clearLISTadtl_();let n=this.cue.points.length;this.cue.points=[];for(let r=0;r<n;r++)r+1!==t&&this.setCuePoint_(e[r].dwPosition,r+1,e[r].label);this.cue.dwCuePoints=this.cue.points.length,this.cue.dwCuePoints?this.cue.chunkId="cue ":(this.cue.chunkId="",this.clearLISTadtl_())}listCuePoints(){let t=this.getCuePoints_();for(let e=0,n=t.length;e<n;e++)t[e].milliseconds=t[e].dwPosition/this.fmt.sampleRate*1e3;return t}updateLabel(t,e){let n=this.getAdtlChunk_();if(null!==n)for(let r=0,i=this.LIST[n].subChunks.length;r<i;r++)this.LIST[n].subChunks[r].dwName==t&&(this.LIST[n].subChunks[r].value=e)}bitDepthFromFmt_(){3===this.fmt.audioFormat&&32===this.fmt.bitsPerSample?this.bitDepth="32f":6===this.fmt.audioFormat?this.bitDepth="8a":7===this.fmt.audioFormat?this.bitDepth="8m":this.bitDepth=this.fmt.bitsPerSample.toString()}setCuePoint_(t,e,n){this.cue.points.push({dwName:e,dwPosition:t,fccChunk:"data",dwChunkStart:0,dwBlockStart:0,dwSampleOffset:t}),this.setLabl_(e,n)}getCuePoints_(){let t=[];for(let e=0,n=this.cue.points.length;e<n;e++)t.push({dwPosition:this.cue.points[e].dwPosition,label:this.getLabelForCuePoint_(this.cue.points[e].dwName)});return t}getLabelForCuePoint_(t){let e=this.getAdtlChunk_();if(null!==e)for(let n=0,r=this.LIST[e].subChunks.length;n<r;n++)if(this.LIST[e].subChunks[n].dwName==t)return this.LIST[e].subChunks[n].value;return""}clearLISTadtl_(){for(let t=0,e=this.LIST.length;t<e;t++)"adtl"==this.LIST[t].format&&this.LIST.splice(t)}setLabl_(t,e){let n=this.getAdtlChunk_();null===n&&(this.LIST.push({chunkId:"LIST",chunkSize:4,format:"adtl",subChunks:[]}),n=this.LIST.length-1),this.setLabelText_(null===n?0:n,t,e)}setLabelText_(t,e,n){this.LIST[t].subChunks.push({chunkId:"labl",chunkSize:n.length,dwName:e,value:n}),this.LIST[t].chunkSize+=n.length+4+4+4+1}getAdtlChunk_(){for(let t=0,e=this.LIST.length;t<e;t++)if("adtl"==this.LIST[t].format)return t;return null}getLISTINFOIndex_(){let t=null;for(let e=0,n=this.LIST.length;e<n;e++)if("INFO"===this.LIST[e].format){t=e;break}return t}getTagIndex_(t){let e={LIST:null,TAG:null};for(let n=0,r=this.LIST.length;n<r;n++)if("INFO"==this.LIST[n].format){e.LIST=n;for(let r=0,i=this.LIST[n].subChunks.length;r<i;r++)if(this.LIST[n].subChunks[r].chunkId==t){e.TAG=r;break}break}return e}fixTagName_(t){if(t.constructor!==String)throw new Error("Invalid tag name.");if(t.length<4)for(let e=0,n=4-t.length;e<n;e++)t+=" ";return t}clearHeader_(){this.fmt.cbSize=0,this.fmt.validBitsPerSample=0,this.fact.chunkId="",this.ds64.chunkId=""}assure16Bit_(){this.assureUncompressed_(),"16"!=this.bitDepth&&this.toBitDepth("16")}assureUncompressed_(){"8a"==this.bitDepth?this.fromALaw():"8m"==this.bitDepth?this.fromMuLaw():"4"==this.bitDepth&&this.fromIMAADPCM()}interleave_(t){if(t.length>0&&t[0].constructor===Array){let e=[];for(let n=0,r=t[0].length;n<r;n++)for(let r=0,i=t.length;r<i;r++)e.push(t[r][n]);t=e}return t}updateDataType_(){this.dataType={bits:1+(parseInt(this.bitDepth,10)-1|7),float:"32f"==this.bitDepth||"64"==this.bitDepth,signed:"8"!=this.bitDepth,be:"RIFX"==this.container},["4","8a","8m"].indexOf(this.bitDepth)>-1&&(this.dataType.bits=8,this.dataType.signed=!1)}correctContainer_(){return"RF64"==this.container?"RIFF":this.container}truncateSamples_(t){for(let e=0,n=t.length;e<n;e++)t[e]>1?t[e]=1:t[e]<-1&&(t[e]=-1)}}}();window.WaveFile=WaveFile;
