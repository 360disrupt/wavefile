<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>wavefile &copy; 2018 Rafael da Silva Rocha. MIT License.</title>
  <script src="../../dist/wavefile-min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/wavesurfer.js/2.0.5/wavesurfer.min.js"></script>
  <style>
  .waveform {
    background-color: #000;
  }
  </style>
</head>
<body>

    <h1>wavefile</h1>

    <p>A demonstration of the use of <a href="https://github.com/rochars/wavefile">wavefile</a> and <a href="https://wavesurfer-js.org/">wavesurfer</a> to create a player that supports 4-bit IMA ADPCM, mu-Law, A-Law, 11-bit wav files, 64-bit wav files and more:</p>

    <!-- drop file -->
    <div id="drop_zone">
        <h2>Drop files here</h2>
        <div id="waveform" class="waveform"></div>
        <input type="button"
            value="Play"
            class="btn btn-default"
            onclick="wavesurfer.playPause()">
    </div>
    <script>
        var wavesurfer = WaveSurfer.create({
                container: '#waveform',
                waveColor: 'green',
                progressColor: 'white'
            });
      function handleFileSelect(evt) {
        evt.stopPropagation();
        evt.preventDefault();

        var files = evt.dataTransfer.files; // FileList object.
        
        var reader = new FileReader();
        reader.onload = function() {
            let wav = new WaveFile(new Uint8Array(this.result));
            if (wav.bitDepth == "8m") {
                wav.fromMuLaw();
            } else if (wav.bitDepth == "8a") {
                wav.fromALaw();
            } else if (wav.bitDepth == "4") {
                wav.fromIMAADPCM();
            }
            wav.toBitDepth("16");
            wavesurfer.load(
                    "data:audio/wav;base64," + encode(wav.toBuffer())
                );
        }
        reader.readAsArrayBuffer(files[0]);
      }

      function handleDragOver(evt) {
        evt.stopPropagation();
        evt.preventDefault();
        evt.dataTransfer.dropEffect = 'copy'; // Explicitly show this is a copy.
      }

      // Setup the dnd listeners.
      var dropZone = document.getElementById('drop_zone');
      dropZone.addEventListener('dragover', handleDragOver, false);
      dropZone.addEventListener('drop', handleFileSelect, false);

      var chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";
      // Use a lookup table to find the index.
      var lookup = new Uint8Array(256);
      for (var i = 0; i < chars.length; i++) {
        lookup[chars.charCodeAt(i)] = i;
      }
      encode = function(arraybuffer) {
        var bytes = new Uint8Array(arraybuffer),
        i, len = bytes.length, base64 = "";
        for (i = 0; i < len; i+=3) {
          base64 += chars[bytes[i] >> 2];
          base64 += chars[((bytes[i] & 3) << 4) | (bytes[i + 1] >> 4)];
          base64 += chars[((bytes[i + 1] & 15) << 2) | (bytes[i + 2] >> 6)];
          base64 += chars[bytes[i + 2] & 63];
        }
        if ((len % 3) === 2) {
          base64 = base64.substring(0, base64.length - 1) + "=";
        } else if (len % 3 === 1) {
          base64 = base64.substring(0, base64.length - 2) + "==";
        }
        return base64;
    }
    </script>
    <!--/drop file -->

    <p>Copyright &copy; 2017-2018 Rafael da Silva Rocha.<br>
        <a href="https://github.com/rochars/wavefile">https://github.com/rochars/wavefile</a></p>

</body>
</html>
